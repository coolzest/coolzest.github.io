<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://coolzest.github.io/notebooks/%E7%90%86%E8%AE%BA%E5%AD%A6%E4%B9%A0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E4%BC%A0%E8%BE%93%E5%B1%82/ rel=canonical><link href=../../../%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF/python%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86Conda%E6%8C%87%E4%BB%A4%E6%89%8B%E5%86%8C/ rel=prev><link href=../%E5%BA%94%E7%94%A8%E5%B1%82/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>传输层 - Coolzest NOTE</title><link rel=stylesheet href=../../../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../css/timeago.css><link rel=stylesheet href=../../../../assets/stylesheets/test.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../.. title="Coolzest NOTE" class="md-header__button md-logo" aria-label="Coolzest NOTE" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Coolzest NOTE </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 传输层 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=indigo aria-label=切换至日间模式 type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=切换至日间模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=indigo aria-label=切换至夜间模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至夜间模式 for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 256 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/coolzest/coolzest.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> coolzest.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../blog/ class=md-tabs__link> 个人博客 </a> </li> <li class=md-tabs__item> <a href=../../../%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B/ class=md-tabs__link> 人工智能 </a> </li> <li class=md-tabs__item> <a href=../../../%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF/2024-04-22-C%2B%2B%E5%9F%BA%E7%A1%80/ class=md-tabs__link> 技术积累 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> 理论学习 </a> </li> <li class=md-tabs__item> <a href=../../../%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/2024-04-22-CTF/ class=md-tabs__link> 网络安全 </a> </li> <li class=md-tabs__item> <a href=../../../%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/2024-08-16-Docker/ class=md-tabs__link> 软件使用 </a> </li> <li class=md-tabs__item> <a href=../../../../friends/ class=md-tabs__link> 朋友 </a> </li> <li class=md-tabs__item> <a href=../../../../guestbook/ class=md-tabs__link> 留言板 </a> </li> <li class=md-tabs__item> <a href=../../../../about/ class=md-tabs__link> 关于我 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title="Coolzest NOTE" class="md-nav__button md-logo" aria-label="Coolzest NOTE" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Coolzest NOTE </label> <div class=md-nav__source> <a href=https://github.com/coolzest/coolzest.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> coolzest.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../blog/ class=md-nav__link> <span class=md-ellipsis> 个人博客 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 人工智能 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF/2024-04-22-C%2B%2B%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> 技术积累 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> 理论学习 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 理论学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1 checked> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex> <span class=md-ellipsis> 计算机网络 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=true> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 计算机网络 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 传输层 </span> </a> </li> <li class=md-nav__item> <a href=../%E5%BA%94%E7%94%A8%E5%B1%82/ class=md-nav__link> <span class=md-ellipsis> 应用层 </span> </a> </li> <li class=md-nav__item> <a href=../%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 概述 </span> </a> </li> <li class=md-nav__item> <a href=../%E7%89%A9%E7%90%86%E5%B1%82/ class=md-nav__link> <span class=md-ellipsis> 物理层 </span> </a> </li> <li class=md-nav__item> <a href=../%E7%BD%91%E7%BB%9C%E5%B1%82/ class=md-nav__link> <span class=md-ellipsis> 网络层 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/2024-04-22-CTF/ class=md-nav__link> <span class=md-ellipsis> 网络安全 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/2024-08-16-Docker/ class=md-nav__link> <span class=md-ellipsis> 软件使用 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../../friends/ class=md-nav__link> <span class=md-ellipsis> 朋友 </span> </a> </li> <li class=md-nav__item> <a href=../../../../guestbook/ class=md-nav__link> <span class=md-ellipsis> 留言板 </span> </a> </li> <li class=md-nav__item> <a href=../../../../about/ class=md-nav__link> <span class=md-ellipsis> 关于我 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>传输层</h1> <p><font style="color:rgb(119, 119, 119);">前言：本文为计算机网络系列第五章笔记，陆续会更新余下内容。文章参了：</font><a href="https://www.bilibili.com/video/BV1c4411d7jb?p=32"><font style="color:rgb(65, 131, 196);">计算机网络微课堂</font></a><font style="color:rgb(119, 119, 119);">、《王道考研计算机网络考研复习指导》、《计算机网络（ 第7版 ）》—— 谢希仁 。本文仅供学习使用，若有侵权联系删除。</font></p> <p><strong><font style="color:rgb(51, 51, 51);">系列文章：</font></strong></p> <p><a href="https://blog.csdn.net/qq_46331050/article/details/120118138?spm=1001.2014.3001.5501"><font style="color:rgb(65, 131, 196);">计算机网络「一」计算机网络概述</font></a></p> <p><a href="https://blog.csdn.net/qq_46331050/article/details/120206230?spm=1001.2014.3001.5501"><font style="color:rgb(65, 131, 196);">计算机网络「二」物理层</font></a></p> <p><a href="https://blog.csdn.net/qq_46331050/article/details/120240563?spm=1001.2014.3001.5501"><font style="color:rgb(65, 131, 196);">计算机网络「三」 数据链路层</font></a></p> <p><a href="https://blog.csdn.net/qq_46331050/article/details/120605118?spm=1001.2014.3001.5501"><font style="color:rgb(65, 131, 196);">计算机网络「四」 网络层</font></a></p> <h2 id=0bb3a62c><font style="color:rgb(51, 51, 51);">一、运输层概述</font></h2> <hr> <p><font style="color:rgb(51, 51, 51);">之前所介绍的计算机网络</font><a href="https://so.csdn.net/so/search?q=%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84&spm=1001.2101.3001.7020"><font style="color:rgb(65, 131, 196);">体系结构</font></a><font style="color:rgb(51, 51, 51);">中的物理层、数据链路层以及网络层，它们共同解决了将主机通过异构网络互联起来所面临的问题，实现了主机到主机的通信。</font></p> <p><font style="color:rgb(51, 51, 51);">但实际上在计算机网络中进行 通信的真正实体是位于通信两端主机中的进程。</font></p> <p><font style="color:rgb(51, 51, 51);">而 如何为运行在不同主机上的应用进程提供直接的通信服务 是运输层的任务，运输层协议又称为 端到端 协议，所谓端到端也就是进程到进程。</font></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310610004-c128be42-7c18-4e34-8717-c183db72fdbf.png></p> <p><strong><font style="color:rgb(119, 119, 119);">从计算机网络体系结构的角度来看运输层</font></strong></p> <p><font style="color:rgb(51, 51, 51);">假设 AP1 与 AP4 之间进行基于网络的通信，AP2 与 AP3 之间进行基于网络的通信。在运输层采用不同端口对应不同进程，然后通过</font><a href="https://so.csdn.net/so/search?q=%E7%BD%91%E7%BB%9C%E5%B1%82&spm=1001.2101.3001.7020"><font style="color:rgb(65, 131, 196);">网络层</font></a><font style="color:rgb(51, 51, 51);">及其下层来传输应用层报文。</font></p> <p><font style="color:rgb(51, 51, 51);">接收方的运输层通过不同的端口，将收到的应用层报文交付给应用层中相应的应用进程。如图所示</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310609894-c6982974-bb6e-4789-9032-8356753d905e.png><font style="color:rgb(51, 51, 51);">可以简单地认为，运输层直接为应用进程间的逻辑通信提供服务。“ 逻辑通信 ” 的意思为运输层间的通信好像是沿水平方向传送数据，但事实上并没有一条水平上的物理连接。</font></p> <p><font style="color:rgb(51, 51, 51);">运输层向高层用户屏蔽了下面网络核心的细节（如网络拓扑、所采用的路由选择协议等），它使应用进程看起来就好像 在两个运输层实体之间有一条端到端的逻辑通信信道 。</font></p> <p><font style="color:rgb(51, 51, 51);">根据应用需求的不同，因特网的运输层为应用层提供了两种不同的运输协议，即 面向连接的TCP 和 无连接的UDP，这两种协议就是本章要讨论的主要内容。 </font></p> <h2 id=b835de6f><font style="color:rgb(51, 51, 51);">二、端口号、复用与分用、套接字</font></h2> <hr> <p><font style="color:rgb(51, 51, 51);">我们知道，运行在计算机上的进程使用 进程标识符 PID 来标志。而因特网上的计算机并不是使用统一的操作系统，不同的操作系统（windows、Linux、Mac OS）又使用 不同格式的进程标识符 。</font></p> <p><font style="color:rgb(51, 51, 51);">为了使运行不同操作系统的计算机的应用进程之间能够进行网络通信，就必须 使用统一的方法对 TCP/IP 体系的应用进程进行标识 。</font></p> <p><font style="color:rgb(51, 51, 51);">TCP/IP 体系的运输层使用 端口号 来区分应用层的不同应用进程。</font></p> <p><strong><font style="color:rgb(119, 119, 119);">端口号</font></strong></p> <p><font style="color:rgb(51, 51, 51);">应用进程通过端口号进行标识。端口号只具有本地意义，即端口号只是为了 标识本计算机应用层中的各进程，在因特网中，不同计算机中的相同端口号是没有联系的 。端口号在运输层的作用相当于 IP 地址 在网络层的作用，或者是 MAC 地址 在</font><a href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82&spm=1001.2101.3001.7020"><font style="color:rgb(65, 131, 196);">数据链路层</font></a><font style="color:rgb(51, 51, 51);">的作用，只不过 IP 地址和 MAC 地址标识的是主机，而端口标识的是主机中的应用进程。</font></p> <p><font style="color:rgb(51, 51, 51);">端口号使用 16 比特表示，取值范围 0 ~ 65535</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">熟知端口号：0 ~ 1023，IANA 把这些端口号指派给了 TCP/IP 体系中最重要的一些应用协议。如 FTP: 21/20、HTTP: 80、DNS: 53</font></li> <li><font style="color:rgb(51, 51, 51);">登记端口号：1024 ~ 49151。它是供没有熟知端口号的应用程序使用的，使用这类端口号必须在 IANA 登记，以防重复。</font></li> <li><font style="color:rgb(51, 51, 51);">短暂端口号：49152 ~ 65535，留给客户进程选择暂时使用。当服务器进程收到客户进程的报文时，就知道了客户进程所使用的动态端口号。通信结束后，这个端口号可供其他客户进程以后使用。</font></li> </ol> <p><strong><font style="color:rgb(119, 119, 119);">发送方的复用和接收方的分用</font></strong></p> <p><strong><font style="color:rgb(51, 51, 51);">复用和分用概念</font></strong><font style="color:rgb(51, 51, 51);">：</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">复用：复用是指发送方不同的应用进程都可使用同一个传输层协议传送数据；</font></li> <li><font style="color:rgb(51, 51, 51);">分用：分用是指接收方的传输层在剥去报文的首部后能够把这些数据正确交付到目的应用进程。</font></li> </ol> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310609932-a11672ce-8bc0-4425-89d3-8047a707df5f.png><font style="color:rgb(51, 51, 51);">补充说明：网络层也有分用和复用：复用是指发送方不同协议的数据都可以封装成 IP 数据报发送出去；分用是指接收方的网络层在剥去首部后把数据交付给相应的协议。</font></p> <p><strong><font style="color:rgb(51, 51, 51);">具体说明复用和分用的过程</font></strong><font style="color:rgb(51, 51, 51);">：</font></p> <p><font style="color:rgb(51, 51, 51);">发送方</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">发送方的某些应用进程所发送的不同应用报文，在运输层使用 UDP 协议封装，称为 UDP 复用；在 运输层使用 TCP 协议封装，称为 TCP 复用 。</font></li> <li><font style="color:rgb(51, 51, 51);">运输层采用端口号来区分不同的应用进程。</font></li> <li><font style="color:rgb(51, 51, 51);">不管是运输层 UDP 协议封装成的 UDP 用户数据报，还是使用 TCP 协议封装成的 TCP 报文段，在网络层都需要使用 IP 协议封装成 IP 数据报，这称为 IP 复用 。</font></li> <li><font style="color:rgb(51, 51, 51);">IP 数据报首部中 协议字段的值 用来表明 IP 数据报的数据载荷部分封装的是何种协议数据单元，如下图：</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310609970-fe46c1a5-bbe3-4253-95af-a74a75b35e7f.png></li> </ol> <p><font style="color:rgb(51, 51, 51);">接收方</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">接收方的网络层收到 IP 数据报后进行 IP 分用。若协议字段为 17，则将用户数据报上交给运输层的 UDP；若协议字段为 6，则上交给运输层的 TCP。</font></li> <li><font style="color:rgb(51, 51, 51);">运输层对 UDP 用户数据报进行 UDP 分用，对 TCP 报文段进行 TCP 分用。也就是根据端口号，将其交付给上层相应的应用进程。</font></li> </ol> <p><strong><font style="color:rgb(119, 119, 119);">一些常用的熟知端口号</font></strong></p> <p><font style="color:rgb(51, 51, 51);">下图所示为 TCP/IP 体系的应用层常用协议，及它们所使用的运输层熟知端口号：</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310609987-cfdca9e5-eb8f-4378-88f8-1e85e6984d1b.png></p> <p><font style="color:rgb(51, 51, 51);">不管在运输层使用 UDP 协议还是 TCP 协议，在网络层都需要使用 IP 协议。IP 数据报首部中协议字段 的值，表明了 IP 数据报数据载荷部分封装的是何种协议数据单元。</font></p> <p><strong><font style="color:rgb(119, 119, 119);">运输层端口号的应用</font></strong></p> <p><font style="color:rgb(51, 51, 51);">如下图，用户 PC、DNS 服务器、Web 服务器通过交换机进行互联，处于同一以太网中。</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310610378-e11ef4cc-e5d6-4365-9075-871d75c68851.png></p> <p><font style="color:rgb(119, 119, 119);">DNS（Domain Name Server，域名服务器）是进行域名 （domain name）和与之相对应的IP地址 (IP address)转换的服务器。DNS 中保存了一张域名和与之相对应的 IP 地址的表，以 解析消息的域名。</font></p> <p><font style="color:rgb(119, 119, 119);">Web 服务器 一般指网站服务器，是指驻留于因特网上某种类型计算机的程序，可以处理浏览器等 Web 客户端的请求并返回相应响应，也可以放置网站文件，让全世界浏览；同时还可以放置数据文件，让全世界下载。</font></p> <p><font style="color:rgb(51, 51, 51);">我们在用户 PC 中使用网页浏览器来访问 Web 服务器的内容。在网页浏览器的地址栏中输入 Web 服务器的域名，用户 PC 中的 DNS 客户端 进程会发送一个 DNS 查询请求报文。该报文使用 UDP 协议封装成 UDP 用户数据报，之后将其封装在 IP 数据报中发送给 DNS 服务器。</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310610611-9d45158a-40e7-467c-ac85-9c74c2283d25.png><font style="color:rgb(51, 51, 51);">DNS 服务器收到后，从中解封出 UDP 用户数据报。因为端口号 53 （DNS 应用程序端口号为 53），所以将数据报的数据载荷部分（查询请求报文）交付给本服务器中的 DNS 服务器端进程。该进程解析查询请求报文的内容后，给用户 PC 发送 DNS 响应报文。之后，通过系列封装成为 IP 数据报，通过以太网发送给用户 PC。</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310610525-7d93838f-4f0c-416a-9fcd-64f2d43a6144.png><font style="color:rgb(51, 51, 51);">用户 PC 收到后，解封出 UDP 用户数据报，根据端口号，将其交付给 PC 中 DNS 客户端进程。该进程解析 DNS 响应报文的内容，得到之前请求域名所对应的 IP 地址为 192.168.0.3 。</font></p> <p><font style="color:rgb(51, 51, 51);">于是，用户 PC 中的 HTTP 客户端进程 可以向 Web 服务器发送 HTTP 请求报文了。该报文需要 TCP 协议封装为 TCP 报文段，之后封装在 IP 数据报中由以太网传输。</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310610524-715f383c-1c20-418b-9e52-d36d9f7f4870.png><font style="color:rgb(51, 51, 51);">Web 服务器收到该数据包后解封出 TCP 报文段，根据其首部中目的端口号为 80，因此将 HTTP 请求报文交给本服务器中的 HTTP 服务器端进程 。该进程解析报文查找内容后，给用户 PC 发送 HTTP 响应报文。</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310610676-7518618d-9818-4041-b8e2-84b923c6c3cd.png><font style="color:rgb(51, 51, 51);">用户 PC 收到并解封，将 HTTP 响应报文交付给用户 PC 中的 HTTP 客户端进程。该进程解析 HTTP 响应报文内容，并在网页浏览器中进行显示。这样，我们就可以成功地从网页中看到 Web 服务器提供的首页内容。</font></p> <p><font style="color:rgb(51, 51, 51);">通过上面这个案例的过程分析，你就可以清楚地了解到端口号的妙用，它为主机中各种应用进程作标识，使得各种请求和响应能够有条不紊的进行。</font></p> <p><strong><font style="color:rgb(119, 119, 119);">套接字</font></strong></p> <p><font style="color:rgb(51, 51, 51);">在网络中通过 IP 地址来标识和区别不同的主机，通过端口号来标识和区分一台主机中的不同应用进程，端口号拼接到 IP 地址 即构成 套接字 Socket 。</font></p> <p><font style="color:rgb(51, 51, 51);">在网络中采用发送方和接收方的套接字来识别端点。</font></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code>套接字 Socket = (IP 地址: 端口号)
</code></pre></div></td></tr></table></div> <h2 id=8c2ef245><font style="color:rgb(51, 51, 51);">三、UDP 和 TCP</font></h2> <hr> <p><font style="color:rgb(51, 51, 51);">TCP/IP 协议族在运输层中使用了两个传输协议：</font></p> <ul> <li><font style="color:rgb(51, 51, 51);">无连接的用户数据报协议 UDP</font></li> </ul> <p><font style="color:rgb(51, 51, 51);">无连接服务是指两个实体之间的通信不需要先建立好连接，需要通信时，直接将信息发送到 “ 网络 ” 中，让该信息的传递在网上尽力而为地传送到目的地。</font></p> <ul> <li><font style="color:rgb(51, 51, 51);">面向连接的传输控制协议 TCP</font></li> </ul> <p><font style="color:rgb(51, 51, 51);">面向连接就是在通信双方通信前，必须先建立连接，整个连接的情况一直被实时地监控和管理。通信结束后，应该释放这个连接。</font></p> <p><strong><font style="color:rgb(119, 119, 119);">UDP协议</font></strong></p> <p><font style="color:rgb(51, 51, 51);">UDP 协议只在 IP 的数据报服务上增加了两个最基本的服务：复用和分用 和 差错检测 。</font></p> <p><font style="color:rgb(51, 51, 51);">UDP 协议有如下优点：</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">UDP 无需建立连接。 不会引入建立连接的时延。</font></li> <li><font style="color:rgb(51, 51, 51);">无连接状态。不需要维护连接状态，无需跟踪如拥塞控制和确认号等参数。</font></li> <li><font style="color:rgb(51, 51, 51);">分组首部开销小。TCP 有 20B 的首部开销，UDP 仅有 8B 的开销。</font></li> <li><font style="color:rgb(51, 51, 51);">应用层能够好地控制发送的数据和发送的时间。</font></li> <li><font style="color:rgb(51, 51, 51);">支持一对一、一对多、多对一和多对多通信。</font></li> </ol> <p><font style="color:rgb(51, 51, 51);">UDP 常用于一次性传输较少数据的网络应用，如 DNS、SNMP 等。</font></p> <p><font style="color:rgb(51, 51, 51);">UDP 不保证可靠交付，但不意味着应用对数据的要求是不可靠的，所有维护可靠性的工作可以由用户在应用层 来完成。</font></p> <p><font style="color:rgb(51, 51, 51);">UDP 是面向报文的。发送方 UDP 对应用层交下来的报文，在添加首部后就向下交付给 IP 层，一次发送一个报文，不合并也不拆分。</font></p> <p><font style="color:rgb(51, 51, 51);">UDP 可以对数据报做包括数据段在内的差错检测（ IP 只对其首部做差错检测）。</font></p> <p><strong><font style="color:rgb(119, 119, 119);">TCP 协议</font></strong></p> <p><font style="color:rgb(51, 51, 51);">TCP 是在不可靠的 IP 层之上实现的可靠的数据传输协议，它主要解决传输的可靠、有序、无丢失和不重复问题。</font></p> <p><font style="color:rgb(51, 51, 51);">TCP 主要有以下特点：</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">TCP 是面向连接的运输层协议。</font></li> <li><font style="color:rgb(51, 51, 51);">每条 TCP 连接只能有两个端点。</font></li> <li><font style="color:rgb(51, 51, 51);">TCP 提供可靠的交付服务。</font></li> <li><font style="color:rgb(51, 51, 51);">TCP 提供全双工通信。允许通信双方的应用进程在任何时候都能发送数据，为此 TCP 连接的两端都设有发送缓存和接收缓存，用于存放临时数据。</font></li> <li><font style="color:rgb(51, 51, 51);">TCP 是面向字节流的。TCP 把应用程序交付的数据仅视为一连串无结构的字节流。</font></li> </ol> <hr> <p><font style="color:rgb(51, 51, 51);">下面从几个方面对 UDP 和 TCP 进行比较说明</font></p> <p><strong><font style="color:rgb(119, 119, 119);">数据传输</font></strong></p> <ul> <li><font style="color:rgb(51, 51, 51);">使用 UDP 协议的通信双方，可以随时发送数据</font></li> <li><font style="color:rgb(51, 51, 51);">使用 TCP 协议的通信双方，在进行数据传输之前，必须 使用 “ 三报文握手 ” 建立 TCP 连接 ，TCP 连接建立成功后才能进行数据传输。数据传输结束后，必须 使用 “ 四报文挥手 ” 来释放 TCP 连接</font></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310610942-d9907a61-2e17-4c05-be41-cbd3083eaec1.png></p> <p><strong><font style="color:rgb(119, 119, 119);">比较是否可以 单播、多播、广播</font></strong></p> <ul> <li><font style="color:rgb(51, 51, 51);">UDP 支持单播、多播以及广播。也就是支持一对一、一对多、一对全的通信。</font></li> <li><font style="color:rgb(51, 51, 51);">TCP 仅支持单播 ，也就是一对一通信。</font></li> </ul> <p><font style="color:rgb(51, 51, 51);">使用 TCP 协议的通信双方，在进行数据传输之前，必须使用 “三报文握手” 来建立 TCP 连接。TCP 连接建立成功后，通信双方之间就好像是有一条可靠的通信信道进行通信。</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310611228-a4601e0a-f813-4ee1-9405-a8f054e251d8.png></p> <p><strong><font style="color:rgb(119, 119, 119);">处理应用报文方式的比较</font></strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310611170-595d9627-7cd0-490c-b661-df75bd7ee277.png></p> <ul> <li><font style="color:rgb(51, 51, 51);">UDP 是面向应用报文的。</font></li> </ul> <p><font style="color:rgb(51, 51, 51);">UDP 对应用进程交下来的报文既不合并也不拆分，而是保留这些报文的边界。</font></p> <ul> <li><font style="color:rgb(51, 51, 51);">TCP 是面向字节流的。</font><ol> <li><font style="color:rgb(51, 51, 51);">发送方的 TCP 把应用进程交付下来的数据块仅仅看作是一连串的、无结构的字节流。TCP 不知其含义，仅将它们编号并存储在自己的发送缓存中。TCP 根据发送策略，从发送缓存中提取一定数量的字节，构建 TCP 报文段并发送。</font></li> <li><font style="color:rgb(51, 51, 51);">接收方的 TCP，一方面从所接收到的 TCP 报文段中取出数据载荷并存储在接收缓存中；一方面将接收缓存中的一些字节交付给应用进程。</font></li> <li><font style="color:rgb(51, 51, 51);">TCP 不保证接收方应用进程所收到的数据块与发送方应用进程所发出的数据块具有对应大小的关系。但接收方应用进程收到的字节流必须和发送方应用进程发出的字节流完全一样。</font></li> </ol> </li> </ul> <p><strong><font style="color:rgb(119, 119, 119);">传输服务的比较</font></strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310611309-feb5ed56-7be7-4cb9-84ff-e166702aaeec.png></p> <p><strong><font style="color:rgb(119, 119, 119);">首部的比较</font></strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310611368-07610734-4d99-409a-8c50-89daf4d25ca5.png></p> <h2 id=57a5167b><font style="color:rgb(51, 51, 51);">四、TCP 报文段</font></h2> <hr> <p><font style="color:rgb(51, 51, 51);">前文中提到，为了实现可靠传输，TCP 采用了 面向字节流 的方式。将应用进程交付下的应用报文看作字节流，存入到 TCP 的发送缓存 中。TCP 在发送数据时，是从发送缓存取出一部分或全部字节给其添加一个首部使其成为 TCP 报文段 后进行发送。如下图：</font></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310611540-2a5a51fc-c4f7-4b6b-b388-86b83bc8b9fa.png></p> <p><font style="color:rgb(51, 51, 51);">一个 TCP 报文段由 首部 和 数据载荷 两部分构成。TCP 的全部功能都体现在它首部中各字段的作用。</font></p> <p><strong><font style="color:rgb(119, 119, 119);">TCP 报文段的首部格式</font></strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310611818-9c0b4664-5108-4ee0-bc05-26edfc6a4aca.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310611860-999a7485-7764-4b69-acc9-8cd3a33552ad.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310612017-53a873a4-b3b3-48dc-8b5f-61bde7e7349f.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310611997-710fc59d-335f-462c-aa8d-6046fa4e6f5f.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310612036-6b07ebbf-a5d0-422f-90c2-d88f1c0d9be4.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310612346-0d891fe6-614e-415d-a15a-7305b5b4f37a.png></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310612363-06745235-0df9-4e03-9a44-e7d492777ab7.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310612511-b0cdd4d6-3b72-4078-a614-74bf6374b0dc.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310612679-2cf66cf8-de42-4f50-9914-a2676ec86711.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310612629-8aceaff4-666a-4ec4-ac29-7849eb51255d.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310612883-e98ec92d-f379-4150-8f2b-6fc16dce2405.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310612941-e654eeb8-032e-49ea-af4f-c85e5e357d81.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310613154-b01cca2d-f028-468d-8db4-342a0a3d0ae9.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310613141-97fe7ce4-6002-4566-958a-083f3fe56845.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310613160-ecf1b377-1941-40e3-83bb-a017409fa37f.png><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310613482-4e32dc6a-07ee-4b02-89f8-f0e433f77400.png></p> <h2 id=e7af3150><font style="color:rgb(51, 51, 51);">五、TCP 的流量控制</font></h2> <hr> <p><font style="color:rgb(51, 51, 51);">一般来说，我们总是希望数据传输可以更快一些。但是如果发送方把数据发送得过快，接收方就可能来不及接收，这就会造成数据的丢失。</font></p> <p><font style="color:rgb(51, 51, 51);">TCP 提供流量控制服务来消除发送方（发送速率太快）使接收方缓存区溢出的可能性。也就是让发送方的发送速率不要太快，要让接收方来得及接收。</font></p> <p><font style="color:rgb(51, 51, 51);">采用 滑动窗口 机制可以很方便地在 TCP 连接上实现对发送方的流量控制。</font></p> <ul> <li><font style="color:rgb(51, 51, 51);">在通信过程中，接收方 根据自己接收缓存的大小，动态地调整发送方的发送窗口大小，称为 接受窗口 rwnd，即调整 TCP 报文段首部中的 “窗口” 字段值，来限制发送方向网络注入报文的速率。</font></li> <li><font style="color:rgb(51, 51, 51);">同时，发送方根据其对当前网络拥塞程度的估计而确定的窗口值，称为 拥塞窗口 cwnd，其大小与网络的带宽和时延密切相关。</font></li> </ul> <p><strong><font style="color:rgb(119, 119, 119);">举例说明</font></strong></p> <p><font style="color:rgb(51, 51, 51);">实际上 TCP 发送方的 发送窗口为 rwnd 和 cwnd 中的最小值，此例中暂不考虑 cwnd。</font></p> <p><font style="color:rgb(51, 51, 51);">例如，在通信中，有效数据只从 A 发往 B，而 B 仅向 A 发送确认报文。如下：</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310613511-9911b27d-9ae7-43d9-980c-b7c047c3c434.png></p> <p><strong><font style="color:rgb(119, 119, 119);">持续计时器 与 零窗口探测报文</font></strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310613850-cee53cbb-e661-4a05-9c7d-216f8bb2c5d0.png><font style="color:rgb(51, 51, 51);">为解决上面死锁的局面，TCP 为每一个连接设有一个 持续计时器 ：</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">只要 TCP 连接的一方收到对方的零窗口通知，就启动持续计时器。若持续计时器超时，就发送一个零窗口探测报文，仅携带 1 字节数据。</font></li> <li><font style="color:rgb(51, 51, 51);">而对方在确认这个探测报文段时，给出自己现在的接受窗口值。如果接收窗口仍为 0，那么收到这个报文段的一方就重新启动持续计时器；如果接收窗口不是 0，那么死锁局面就被打破了。</font></li> </ol> <p><font style="color:rgb(51, 51, 51);">问题 1：接收窗口为 0 还怎么接收探测报文 ？</font></p> <p><font style="color:rgb(51, 51, 51);">答：TCP 规定，即使接收窗口为 0，也必须接收零窗口探测报文段、确认报文段以及携带有紧急数据的报文段。</font></p> <p><font style="color:rgb(51, 51, 51);">问题 2：如果零窗口探测报文也丢失了呢 ？</font></p> <p><font style="color:rgb(51, 51, 51);">答：零窗口探测报文段也有重传计时器。</font></p> <p><strong><font style="color:rgb(119, 119, 119);">练习</font></strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310613692-d2a2ecdc-8d79-47d8-8c33-cd46478aff4f.png></p> <h2 id=9c017e59><font style="color:rgb(51, 51, 51);">六、TCP 的拥塞控制</font></h2> <hr> <p><font style="color:rgb(51, 51, 51);">在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络性能就要变坏。这种情况就叫做 拥塞 。若出现拥塞而不进行控制，整个网络的吞吐量将随输入负荷的增大而下降。见下图：</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310613874-8d826a24-4a84-471e-998b-13fc7f281d4b.png></p> <p><strong><font style="color:rgb(51, 51, 51);">出现网络拥塞如何进行控制呢 ？</font></strong></p> <p><strong><font style="color:rgb(51, 51, 51);">可以采用 慢开始、拥塞避免、快重传、快恢复 四种算法。</font></strong><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310614118-7f9fd797-39e9-4108-9cf2-39ee4f87e428.png></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310614177-ae9a87e7-d74a-4882-a319-8738a6dd73f5.png></p> <p><font style="color:rgb(51, 51, 51);">发送方维护一个叫做 拥塞窗口 cwnd 的状态变量，其值取决于网络的拥塞程度，并且动态变化。</font></p> <ul> <li><font style="color:rgb(51, 51, 51);">拥塞窗口的维护原则：只要网络没有出现拥塞，拥塞窗口就再增大一些；只要网络减少一些，拥塞窗口就减少一些</font></li> <li><font style="color:rgb(51, 51, 51);">判断出现网络拥塞的依据：没有按时收到应当到达的确认报文（即发生超时重传）</font></li> </ul> <p><font style="color:rgb(51, 51, 51);">发送方将拥塞窗口作为 发送窗口 swnd，即 swnd = cwnd 。</font></p> <p><font style="color:rgb(51, 51, 51);">发送方还需维护一个叫做 慢开始门限 ssthresh 的 状态变量：</font></p> <ul> <li><font style="color:rgb(51, 51, 51);">当 cwnd &lt; ssthresh 时，使用慢开始算法</font></li> <li><font style="color:rgb(51, 51, 51);">当 cwnd &gt; ssthresh 时，停止使用慢开始算法而改用拥塞避免算法</font></li> <li><font style="color:rgb(51, 51, 51);">当 cwnd = ssthresh 时，即可使用慢开始算法，也可使用拥塞避免算法</font></li> </ul> <p><strong><font style="color:rgb(119, 119, 119);">慢开始和拥塞避免</font></strong></p> <p><strong><font style="color:rgb(51, 51, 51);">1</font></strong><strong><font style="color:rgb(51, 51, 51);">.</font></strong><strong><font style="color:rgb(51, 51, 51);"> 慢开始算法</font></strong></p> <p><font style="color:rgb(51, 51, 51);">在 TCP 刚刚连接好并开始发送 TCP 报文段时，先令拥塞窗口 cwnd = 1，即一个最大报文段长度 MSS。每收到一个对新报文段的确认后，将 cwnd 加 1，即增大一个 MSS。用这样的方法逐步增大发送方的 cwnd。cwnd 增大到一个规定的慢开始门限 ssthresh（阈值），然后改用 拥塞避免算法。</font></p> <p><font style="color:rgb(51, 51, 51);">说明：慢开始的 “慢” 并不是指 cwnd 增长速率慢，它是指数增长的。它的慢是说，开始时 cwnd = 1，只发送一个报文段。 </font></p> <p><strong><font style="color:rgb(51, 51, 51);">2</font></strong><strong><font style="color:rgb(51, 51, 51);">.</font></strong><strong><font style="color:rgb(51, 51, 51);"> 拥塞避免算法</font></strong></p> <p><font style="color:rgb(51, 51, 51);">其思路是让拥塞窗口 cwnd 缓慢增大。具体做法：每经过一个往返时延 RTT 就把发送方的拥塞窗口 cwnd 加 1，使其线性缓慢增大。 </font></p> <p><strong><font style="color:rgb(51, 51, 51);">具体应用分析</font></strong></p> <p><font style="color:rgb(51, 51, 51);">无论慢开始阶段还是在拥塞避免阶段，只要发送方判断网络出现拥塞（未按时收到确认），就要把慢开始门限 ssthresh 设置为出现拥塞时的发送方的 cwnd 值的一半（但不能小于 2）。</font></p> <p><font style="color:rgb(51, 51, 51);">然后把拥塞窗口 cwnd 重新设置为 1，执行慢开始算法。</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310614461-1a7788be-427b-4605-bf54-648bec5d81bd.png><font style="color:rgb(51, 51, 51);">拥塞避免并不能完全避免拥塞，只是使网络比较不容易出现拥塞。</font></p> <p><strong><font style="color:rgb(119, 119, 119);">快重传和快恢复</font></strong></p> <p><font style="color:rgb(51, 51, 51);">有时，个别报文段会在网络中丢失，但实际上网络并没有出现拥塞。但是它导致了发送方超时重传，因此被误认为网络发生了拥塞。这使得传输效率有所降低。于是，快重传和快恢复算法对慢开始和拥塞避免算法进行了改进。</font></p> <p><strong><font style="color:rgb(51, 51, 51);">1</font></strong><strong><font style="color:rgb(51, 51, 51);">.</font></strong><strong><font style="color:rgb(51, 51, 51);"> 快重传算法</font></strong></p> <p><font style="color:rgb(51, 51, 51);">所谓快重传，就是使发送方尽快进行重传，而不是等超时重传计时器超时再重传。这就要求发送方：</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">不要等待自己发送数据时才捎带确认，而是 要立即发送确认；</font></li> <li><font style="color:rgb(51, 51, 51);">即使收到了失序的报文段也要立即发出对已收到的报文段的 重复确认；</font></li> <li><font style="color:rgb(51, 51, 51);">一旦接收到 3 个连续的重复确认，就将相应的报文段 立即重传，而不是等待该报文段的超时重传计时器超时再重传。</font></li> </ol> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310614440-7bfaaa90-b360-4c38-9a62-dc7c0f30c353.png><font style="color:rgb(51, 51, 51);">对于个别丢失的报文段，发送方不会出现超时重传，也就不会误认为出现了拥塞（进而降低拥塞窗口 cwnd 为 1）。使用快重传可以使整个网络的吞吐量提高约 20% 。 </font></p> <p><strong><font style="color:rgb(51, 51, 51);">2</font></strong><strong><font style="color:rgb(51, 51, 51);">.</font></strong><strong><font style="color:rgb(51, 51, 51);"> 快恢复算法</font></strong></p> <p><font style="color:rgb(51, 51, 51);">发送方一旦收到 3 个重复确认，就知道现在只是丢失了个别的报文段。于是不启动慢开始算法，而执行快恢复算法：</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">发送方 将慢开始门限 ssthresh 值和拥塞窗口 cwnd 值调整为当前窗口的一半（这是为了预防网络发生拥塞），而后开始执行拥塞避免算法。</font></li> <li><font style="color:rgb(51, 51, 51);">也有的快恢复实现是把 cwnd 调整为 ssthresh + 3（网络没有发生拥塞，同时减少了 3 个报文段，可以适当把拥塞窗口扩大些）</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310614430-a25b8905-d74e-4495-b65a-ba9333e44727.png></li> </ol> <p><strong><font style="color:rgb(119, 119, 119);">练习</font></strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310614721-db9aee37-5d7d-42a3-b443-75698a836a9f.png><font style="color:rgb(51, 51, 51);">这个题刚开始做时以为是快重传和快恢复，原因是没有注意到是发生了超时。发生超时应该使用慢开始和拥塞避免算法。</font></p> <h2 id=b2c49101><font style="color:rgb(51, 51, 51);">七、TCP 超时重传的选择</font></h2> <hr> <p><font style="color:rgb(51, 51, 51);">超时重传时间的选择是 TCP 最复杂的问题之一。</font></p> <p><font style="color:rgb(51, 51, 51);">我们 不能直接使用某次测量得到的 RTT 样本来计算超时重传时间 RTO，如下图：</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310614698-68842b2a-4bb7-44f0-869c-ffae1eaaa2bf.png></p> <p><font style="color:rgb(51, 51, 51);">但是可以利用每次测量得到的 RTT 样本，计算 加权平均往返时间 RTTs（又称为平滑的往返时间）</font></p> <p><font style="color:rgb(51, 51, 51);">测量方法如下所示，用这种方法得出的加权平均往返时间 RTTs 就比测量出的 RTT 值更加平滑</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310615107-b452abd0-d53a-4fb1-b539-12ecb91aebef.png></p> <p><strong><font style="color:rgb(119, 119, 119);">计算超时重传时间 RTO</font></strong></p> <p><font style="color:rgb(51, 51, 51);">显然，超时重传时间 RTO 应略大于加权平均往返时间 RTTs 。</font></p> <p><font style="color:rgb(51, 51, 51);">RFC6298 建议使用下式计算超时重传时间 RTO：</font></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310615058-13e1ee76-9b21-4573-ab28-fb0041b1a22e.png></p> <p><strong><font style="color:rgb(119, 119, 119);">往返时间 RTT 的测量</font></strong></p> <p><font style="color:rgb(51, 51, 51);">往返时间 RTT 的测量比较复杂。下面举两个例子来进行说明：</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310615113-f4d5c0b1-8906-4563-bcf6-148fb3e46a57.png></p> <p><strong><font style="color:rgb(51, 51, 51);">针对出现超时重传时无法测准往返时间 RTT 的问题，Karn 提出了一个算法：在计算加权平均往返时间 RTTs 时，只要报文段重传，就不采用其往返时间 RTT 样本。</font></strong></p> <p><font style="color:rgb(51, 51, 51);">也就是说，出现重传时，不重新计算 RTTs ，进而超时重传时间 RTO 也不会重新计算。</font></p> <p><font style="color:rgb(51, 51, 51);">此外，为解决时延突然增大并且长时间维持高时延时，报文段都会重传，导致超时重传时间无法更新，报文段反复重传的问题。需要 对 Karn 算法进行修正：报文段每重传一次，就把超时重传时间 RTO 增大一些。典型的做法时将新 RTO 的值取为旧 RTO 值的 2 倍。</font></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310615268-f356d8ec-10d0-4914-b56a-b993abd2cb22.png></p> <h2 id=59872a47><font style="color:rgb(51, 51, 51);">八、TCP 可靠传输的实现</font></h2> <hr> <p><strong><font style="color:rgb(51, 51, 51);">TCP 基于 以字节为单位的滑动窗口 来实现可靠传输</font></strong><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310615385-ab909d6b-19f1-42c4-bbdf-f8a839161ba6.png><strong><font style="color:rgb(51, 51, 51);">如何描述发送窗口的状态？（编程实现）</font></strong><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310615713-d86ad49f-2509-4472-83de-701b9a714a9e.png><strong><font style="color:rgb(51, 51, 51);">TCP 可靠传输的实现还需注意以下几点：</font></strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310615777-d645763a-21ed-4711-9c77-981438f56944.png></p> <p><strong><font style="color:rgb(119, 119, 119);">习题</font></strong></p> <p><strong><font style="color:rgb(51, 51, 51);">习题一</font></strong><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310615701-49462f3e-ced2-4d9b-a0d3-7a5083abad87.png><strong><font style="color:rgb(51, 51, 51);">习题二</font></strong><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310615877-0b6e6965-b4fc-4ed3-b4e4-6cf3e90ee874.png></p> <h2 id=085b5b25><font style="color:rgb(51, 51, 51);">九、TCP 的运输连接管理</font></h2> <hr> <p><font style="color:rgb(51, 51, 51);">TCP 是面向连接的协议，它基于运输连接来传送 TCP 报文段。TCP 运输连接的建立和释放是每一次面向连接的通信中必不可少的过程。TCP 的运输连接管理就是使 运输连接的建立和释放 都能正常地进行。</font></p> <p><font style="color:rgb(51, 51, 51);">TCP 运输连接有以下三个阶段：</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">建立 TCP 连接</font></li> <li><font style="color:rgb(51, 51, 51);">数据传送</font></li> <li><font style="color:rgb(51, 51, 51);">释放 TCP 连接</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310616069-2214630f-4729-46c9-acf1-6c5d94d2f8ee.png></li> </ol> <p><font style="color:rgb(51, 51, 51);">TCP 把连接作为最基本的抽象，每条 TCP 连接有两个端点，TCP 连接的端点不是主机，不是主机的 IP 地址，不是应用进程，也不是传输层的协议端口。TCP 连接的端口即为 套接字 或 插口，每条 TCP 连接唯一地被通信的两个端点（即两个套接字）确定。</font></p> <p><font style="color:rgb(51, 51, 51);">TCP 连接的建立采用 客户/服务器方式 。主动发起连接建立的应用进程称为 客户（Client），而被动等待连接建立的应用进程称为 服务器（Sever）。</font></p> <p><strong><font style="color:rgb(119, 119, 119);">TCP 的连接建立</font></strong></p> <p><strong><font style="color:rgb(51, 51, 51);">TCP 的连接建立要解决以下三个问题</font></strong></p> <ol> <li><font style="color:rgb(51, 51, 51);">使 TCP 双方能够确知对方的存在</font></li> <li><font style="color:rgb(51, 51, 51);">使 TCP 双方能够协商一些参数（如最大窗口值、是否使用窗口扩大选项和时间戳选项以及服务质量等）</font></li> <li><font style="color:rgb(51, 51, 51);">使 TCP 双方能够对运输实体资源（如缓存大小、连接表中的项目等）进行分配</font></li> </ol> <p><strong><font style="color:rgb(51, 51, 51);">TCP 使用 “ 三报文握手 ” 建立连接</font></strong><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310616348-a472638a-ef90-4788-8de3-9670d6867b01.png></p> <p><font style="color:rgb(119, 119, 119);">详细描述见 《计算机网络（ 第7版 ）》—— 谢希仁 P239</font></p> <p><font style="color:rgb(51, 51, 51);">最初，两端的 TCP 进程都处于 CLOSED（关闭）状态。</font></p> <p><font style="color:rgb(51, 51, 51);">一开始，TCP 服务进程首先创建 传输控制块 TCB（存储连接的重要信息，如 TCP 连接表、指向发送和接收缓存的指针、当前的发送和接收序号等），之后就准备接受连接请求。此时， TCP 服务器进程就进入了 LISTEN（收听） 状态，等待客户的连接请求。</font></p> <p><font style="color:rgb(51, 51, 51);">TCP 客户进程也是首先创建 传输控制块 TCB 。然后，在打算建立连接时，分为以下三步进行操作：</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">TCP 客户进程向 TCP 服务进程发送 TCP 连接请求报文段，并进入 SYN - SENT（同步已发送）状态。TCP 连接请求报文首部中的同步位置 SYN 被设置为 1，表明这时一个 TCP 连接请求报文段。序号字段 seq 被设置了一个初始值 x，作为 TCP 客户进程所选择的初始序号。</font></li> </ol> <p><font style="color:rgb(51, 51, 51);">注意： TCP 规定，SYN 被设置为 1 的报文段不能携带数据，但要消耗掉一个序号。</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">TCP 服务进程收到连接请求报文端后，如果同意建立连接，则向 TCP 客户进程发送 TCP 连接请求确认报文段，并进入 SYN - RCVD（同步收到）状态。该报文段首部中的同步位 SYN 和确认位 ACK 都设置为 1，表明这时一个 TCP 连接请求确认报文段。序号字段 seq 被设置了一个初始值 y，作为 TCP 服务器进程所选择的初始序号。确认号字段 ack 的值被设置成了 x + 1，这是对 TCP 客户进程所选择的初始序号的确认。</font></li> </ol> <p><font style="color:rgb(51, 51, 51);">注意：确认报文段也不能携带数据，但也要消耗掉一个序号。</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">当 TCP 客户进程收到 TCP 连接请求确认报文段后，还要向 TCP 服务器发送一个普通的 TCP 确认报文段，并进入 ESTABLISHED（已建立连接）状态。该报文段首部中的确认位 ACK 被设置为 1，表明这是一个普通 TCP 确认报文段。序号字段 seq 被设置为 x + 1，这是因为 TCP 客户进程发送的第一个 TCP 报文段的序号为 x，因此第二个序号为 x + 1。确认号字段 ack 被设置为 y + 1，这是对 TCP 服务器进程所选择的初始序号的确认。TCP 服务器进程收到该确认报文段后，也进入 ESTABLISHED（已建立连接）状态。</font></li> </ol> <p><font style="color:rgb(51, 51, 51);">注意：TCP 规定，普通的 TCP 确认报文段可以携带数据。但如果不携带数据，则不消耗序号，这种情况下，所发送的下一个数据报文段序号仍是 x + 1。</font></p> <p><strong><font style="color:rgb(51, 51, 51);">思考一个问题：为什么 TCP 客户进程最后还要发送一个普通的 TCP 确认报文段呢 ？ 能否简化为 “两报文握手” 来建立连接呢 ？</font></strong></p> <p><font style="color:rgb(51, 51, 51);">答案是否定的。这主要是为了防止已失效的连接请求报文段突然又传送到了 TCP 服务器进程，因而产生错误。如下图：</font><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310616421-0adeb2f9-2e34-42e5-ac7e-401e8420bd6b.png></p> <p><strong><font style="color:rgb(51, 51, 51);">来道习题巩固一下</font></strong><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310616506-695f927a-e14a-41dd-91df-22b05b9bbfd5.png></p> <p><strong><font style="color:rgb(119, 119, 119);">TCP 的连接释放</font></strong></p> <p><strong><font style="color:rgb(51, 51, 51);">TCP 通过 “ 四报文挥手 ” 来释放连接</font></strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310616448-3be26e9f-1926-44fc-ad5d-d7d9addf2b32.png></p> <ol> <li><font style="color:rgb(51, 51, 51);">假设使用 TCP 客户进程的应用进程通知其主动关闭 TCP 连接，TCP 客户进程会发送 TCP 连接释放报文段，并进入 FIN - WAIT - 1（终止等待 1）状态。该报文段首部中的终止位 FIN 和确认位 ACK 的值都被设置为 1，表明这是一个 TCP 连接释放报文段，同时也对此前收到的报文段进行确认。序号 seq 字段设置为 u，它等于前面已传送过的、数据的最后一个字节的序号加 1。确认号 ack 字段的值设置为 v，它等于 TCP 客户进程之前已收到的、数据的最后一个字节的序号加 1。</font></li> </ol> <p><font style="color:rgb(51, 51, 51);">注意：TCP 规定，终止位 FIN 等于 1 的报文段即使不携带数据，也要消耗掉一个序号。</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">TCP 服务器进程收到 TCP 连接释放报文段后，会发送一个普通的 TCP 确认报文段，并进入 CLOSE - WAIT（关闭等待）状态。该报文段首部中的确认位 ACK 的值被设置为 1，表明这是一个普通的 TCP 确认报文段。序号 seq 字段的值设置为 v，它等于 TCP 服务器进程之前已传送过的数据的最后一个字节的序号加 1。确认号 ack 字段的值设置为 u + 1，这是对 TCP 连接释放报文段的确认。</font></li> </ol> <p><font style="color:rgb(51, 51, 51);">TCP 服务器进程这时应通知高层应用进程：TCP 客户进程要断开与自己的 TCP 连接。此时，从 TCP 客户进程到 TCP 服务器进程这个方向上的连接就释放了，TCP 连接属于 半关闭状态 。但若服务器发送数据，客户进程仍要接收，即从服务器进程到客户进程这个方向上的连接未关闭。</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">TCP 客户进程收到 TCP 确认报文段后就进入 FIN - WAIT - 2（终止等待 2） 状态，等待 TCP 服务进程发出的 TCP 连接释放报文段。若 TCP 服务器进程已没有数据发送，应用进程就通知其 TCP 服务器进程释放连接。TCP 服务器进程发送 TCP 释放报文段并进入 LAST - ACK（最后确认）状态。该报文段首部中的终止位 FIN 和确认位 ACK 都被设置为 1，表明这是一个 TCP 连接释放报文，同时也对之前收到的报文段进行确认。假设 seq 为 w，这是因为半关闭状态可能又发送了一些数据。确认号 ack 字段的值为 u + 1，这是对之前收到的 TCP 连接释放报文段的重复确认。</font></li> <li><font style="color:rgb(51, 51, 51);">TCP 客户进程收到 TCP 连接释放报文段后，必须针对该报文段发送普通的 TCP 确认报文段，之后进入 TIME - WAIT（时间等待）状态。该报文段首部中的 ACK 的值被设置为 1，表明这是一个普通的 TCP 确认报文段。序号 seq 字段的值设置为 u + 1，这是因为 TCP 客户进程之前发送的 TCP 连接释放报文段虽然不携带数据，但要消耗掉一个序号。确认号 ack 字段的值设置为 w + 1，这是对所收到的 TCP 连接释放报文段的确认。TCP 服务器进程收到该报文段后，就进入 CLOSED（关闭）状态。而 TCP 客户进程还需经过 2MSL 后才进入关闭状态。</font></li> </ol> <p><font style="color:rgb(119, 119, 119);">MSL (Maximum Segment Lifetime)：最大报文段寿命。RFC793 建议 2 分钟。对于目前的网络，2 分钟可能过长，因此 TCP 允许不同的实现可根据具体情况使用更小的 MSL 值。</font></p> <p><strong><font style="color:rgb(51, 51, 51);">又有一个问题：TCP 客户进程发送完最后一个确认报文段后，为什么不直接进入关闭状态，而是 2MSL 后才进入关闭状态 ？</font></strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743310616612-b396a246-c264-46d7-9fff-34ce8049e4e0.png><font style="color:rgb(51, 51, 51);">主要原因有两点：</font></p> <ol> <li><font style="color:rgb(51, 51, 51);">确保 TCP 服务器进程进入关闭状态。因为 TCP 客户进程发送的普通 TCP 确认报文段可能会丢失，TCP 服务器进程会对该报文段超时重传。但是由于没有等待 2MSL 时长 TCP 客户进程直接进入关闭状态，因为 TCP 客户进程无法对超时重传的报文进行确认，从而导致 TCP 服务器进程一直在超时重传无法进入关闭状态。</font></li> <li><font style="color:rgb(51, 51, 51);">等待 2MSL 时间，可以使得本次连接中所产生的所有报文段都从网络中消失，避免影响下一次的连接。</font></li> </ol> <hr> <p><font style="color:rgb(51, 51, 51);">本文转自 </font><a href=https://blog.csdn.net/qq_46331050/article/details/120893402><font style="color:rgb(65, 131, 196);">https://blog.csdn.net/qq_46331050/article/details/120893402</font></a><font style="color:rgb(51, 51, 51);">，如有侵权，请联系删除。</font></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="February 9, 2026 11:12:24 CET"><span class=timeago datetime=2026-02-09T11:12:24+01:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="February 9, 2026 11:12:24 CET">2026-02-09</span> </span> <span class=md-source-file__fact> <span class=md-icon title=创建日期> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="February 9, 2026 11:12:24 CET"><span class=timeago datetime=2026-02-09T11:12:24+01:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="February 9, 2026 11:12:24 CET">2026-02-09</span> </span> <span class=md-source-file__fact> <span class=md-icon title=贡献者> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg> </span> <nav> <a href=mailto:coolzest@qq.com>coolzest</a> </nav> </span> </aside> <!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Determine feedback configuration --> <!-- Determine whether to show feedback --> <!-- Was this page helpful? --> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3l137.4 137.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160zm160 352-160-160c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3l137.4 137.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../../../%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF/python%E5%AD%A6%E4%B9%A0/%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86Conda%E6%8C%87%E4%BB%A4%E6%89%8B%E5%86%8C/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 环境管理Conda指令手册"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 256 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 环境管理Conda指令手册 </div> </div> </a> <a href=../%E5%BA%94%E7%94%A8%E5%B1%82/ class="md-footer__link md-footer__link--next" aria-label="下一页: 应用层"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> 应用层 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022~2025 Coolzest </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/coolzest target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=agkFBQYQDxkeKhsbRAkFBw" target=_blank rel=noopener title=邮箱 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "../../../..", "features": ["announce.dismiss", "navigation.prune", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "toc.follow", "navigation.indexes", "content.tabs.link", "content.tooltips", "content.code.copy", "content.code.select", "navigation.instant.prefetch", "navigation.sections"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../../../js/timeago.min.js></script> <script src=../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../assets/javascripts/custom.js></script> <script src=../../../../assets/javascripts/click-copy-math.js></script> <script src=https://cdn.jsdelivr.net/npm/codemirror@5.65.2/lib/codemirror.js></script> <script src=https://cdn.jsdelivr.net/npm/codemirror@5.65.2/mode/python/python.js></script> <script src=https://cdn.jsdelivr.net/npm/codemirror@5.65.2/addon/edit/closetag.js></script> </body> </html>