<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://coolzest.github.io/notebooks/%E7%90%86%E8%AE%BA%E5%AD%A6%E4%B9%A0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E5%B1%82/ rel=canonical><link href=../%E7%89%A9%E7%90%86%E5%B1%82/ rel=prev><link href=../../../%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/2024-04-22-CTF/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>网络层 - Coolzest NOTE</title><link rel=stylesheet href=../../../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../css/timeago.css><link rel=stylesheet href=../../../../assets/stylesheets/test.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../.. title="Coolzest NOTE" class="md-header__button md-logo" aria-label="Coolzest NOTE" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Coolzest NOTE </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 网络层 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=indigo aria-label=切换至日间模式 type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=切换至日间模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=indigo aria-label=切换至夜间模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换至夜间模式 for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 256 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/coolzest/coolzest.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> coolzest.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../blog/ class=md-tabs__link> 个人博客 </a> </li> <li class=md-tabs__item> <a href=../../../%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B/ class=md-tabs__link> 人工智能 </a> </li> <li class=md-tabs__item> <a href=../../../%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF/2024-04-22-C%2B%2B%E5%9F%BA%E7%A1%80/ class=md-tabs__link> 技术积累 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../%E4%BC%A0%E8%BE%93%E5%B1%82/ class=md-tabs__link> 理论学习 </a> </li> <li class=md-tabs__item> <a href=../../../%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/2024-04-22-CTF/ class=md-tabs__link> 网络安全 </a> </li> <li class=md-tabs__item> <a href=../../../%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/2024-08-16-Docker/ class=md-tabs__link> 软件使用 </a> </li> <li class=md-tabs__item> <a href=../../../../friends/ class=md-tabs__link> 朋友 </a> </li> <li class=md-tabs__item> <a href=../../../../guestbook/ class=md-tabs__link> 留言板 </a> </li> <li class=md-tabs__item> <a href=../../../../about/ class=md-tabs__link> 关于我 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title="Coolzest NOTE" class="md-nav__button md-logo" aria-label="Coolzest NOTE" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Coolzest NOTE </label> <div class=md-nav__source> <a href=https://github.com/coolzest/coolzest.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> coolzest.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../blog/ class=md-nav__link> <span class=md-ellipsis> 个人博客 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 人工智能 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF/2024-04-22-C%2B%2B%E5%9F%BA%E7%A1%80/ class=md-nav__link> <span class=md-ellipsis> 技术积累 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> 理论学习 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 理论学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1 checked> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex> <span class=md-ellipsis> 计算机网络 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=true> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> 计算机网络 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../%E4%BC%A0%E8%BE%93%E5%B1%82/ class=md-nav__link> <span class=md-ellipsis> 传输层 </span> </a> </li> <li class=md-nav__item> <a href=../%E5%BA%94%E7%94%A8%E5%B1%82/ class=md-nav__link> <span class=md-ellipsis> 应用层 </span> </a> </li> <li class=md-nav__item> <a href=../%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 概述 </span> </a> </li> <li class=md-nav__item> <a href=../%E7%89%A9%E7%90%86%E5%B1%82/ class=md-nav__link> <span class=md-ellipsis> 物理层 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 网络层 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 网络层 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 一、网络层概述 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 二、网络层提供的两种服务 </span> </a> </li> <li class=md-nav__item> <a href=#ipv4 class=md-nav__link> <span class=md-ellipsis> 三、IPv4地址 </span> </a> <nav class=md-nav aria-label=三、IPv4地址> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1 class=md-nav__link> <span class=md-ellipsis> 1. 分类编址 </span> </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> <span class=md-ellipsis> 2. 划分子网 </span> </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> <span class=md-ellipsis> 3. 无分类编址 </span> </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> <span class=md-ellipsis> 4. 应用规划 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ip class=md-nav__link> <span class=md-ellipsis> 四、IP数据报的发送和转发过程 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 五、静态路由配置及路由环路问题 </span> </a> <nav class=md-nav aria-label=五、静态路由配置及路由环路问题> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1_1 class=md-nav__link> <span class=md-ellipsis> 1. 静态路由配置 </span> </a> </li> <li class=md-nav__item> <a href=#2_1 class=md-nav__link> <span class=md-ellipsis> 2. 环路问题 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 六、路由选择 </span> </a> <nav class=md-nav aria-label=六、路由选择> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1_2 class=md-nav__link> <span class=md-ellipsis> 1. 路由选择协议概述 </span> </a> </li> <li class=md-nav__item> <a href=#2-rip class=md-nav__link> <span class=md-ellipsis> 2. 路由信息协议RIP </span> </a> </li> <li class=md-nav__item> <a href=#3-ospf class=md-nav__link> <span class=md-ellipsis> 3. 开放最短路径优先OSPF </span> </a> </li> <li class=md-nav__item> <a href=#4-bgp class=md-nav__link> <span class=md-ellipsis> 4. 边界网关协议BGP </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ipv4_1 class=md-nav__link> <span class=md-ellipsis> 七、IPv4数据报的首部格式 </span> </a> </li> <li class=md-nav__item> <a href=#icmp class=md-nav__link> <span class=md-ellipsis> 八、网际控制报文协议ICMP </span> </a> <nav class=md-nav aria-label=八、网际控制报文协议ICMP> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-icmp class=md-nav__link> <span class=md-ellipsis> 1. ICMP差错报文 </span> </a> </li> <li class=md-nav__item> <a href=#2-icmp class=md-nav__link> <span class=md-ellipsis> 2. ICMP询问报文 </span> </a> </li> <li class=md-nav__item> <a href=#3-icmp class=md-nav__link> <span class=md-ellipsis> 3. ICMP应用举例 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vpnnat class=md-nav__link> <span class=md-ellipsis> 九、虚拟专用网VPN与网络地址转换NAT </span> </a> <nav class=md-nav aria-label=九、虚拟专用网VPN与网络地址转换NAT> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-vpn class=md-nav__link> <span class=md-ellipsis> 1. 虚拟专用网VPN </span> </a> </li> <li class=md-nav__item> <a href=#2-nat class=md-nav__link> <span class=md-ellipsis> 2. 网络地址转换NAT </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/2024-04-22-CTF/ class=md-nav__link> <span class=md-ellipsis> 网络安全 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/2024-08-16-Docker/ class=md-nav__link> <span class=md-ellipsis> 软件使用 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../../friends/ class=md-nav__link> <span class=md-ellipsis> 朋友 </span> </a> </li> <li class=md-nav__item> <a href=../../../../guestbook/ class=md-nav__link> <span class=md-ellipsis> 留言板 </span> </a> </li> <li class=md-nav__item> <a href=../../../../about/ class=md-nav__link> <span class=md-ellipsis> 关于我 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 一、网络层概述 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 二、网络层提供的两种服务 </span> </a> </li> <li class=md-nav__item> <a href=#ipv4 class=md-nav__link> <span class=md-ellipsis> 三、IPv4地址 </span> </a> <nav class=md-nav aria-label=三、IPv4地址> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1 class=md-nav__link> <span class=md-ellipsis> 1. 分类编址 </span> </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> <span class=md-ellipsis> 2. 划分子网 </span> </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> <span class=md-ellipsis> 3. 无分类编址 </span> </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> <span class=md-ellipsis> 4. 应用规划 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ip class=md-nav__link> <span class=md-ellipsis> 四、IP数据报的发送和转发过程 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 五、静态路由配置及路由环路问题 </span> </a> <nav class=md-nav aria-label=五、静态路由配置及路由环路问题> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1_1 class=md-nav__link> <span class=md-ellipsis> 1. 静态路由配置 </span> </a> </li> <li class=md-nav__item> <a href=#2_1 class=md-nav__link> <span class=md-ellipsis> 2. 环路问题 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 六、路由选择 </span> </a> <nav class=md-nav aria-label=六、路由选择> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1_2 class=md-nav__link> <span class=md-ellipsis> 1. 路由选择协议概述 </span> </a> </li> <li class=md-nav__item> <a href=#2-rip class=md-nav__link> <span class=md-ellipsis> 2. 路由信息协议RIP </span> </a> </li> <li class=md-nav__item> <a href=#3-ospf class=md-nav__link> <span class=md-ellipsis> 3. 开放最短路径优先OSPF </span> </a> </li> <li class=md-nav__item> <a href=#4-bgp class=md-nav__link> <span class=md-ellipsis> 4. 边界网关协议BGP </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ipv4_1 class=md-nav__link> <span class=md-ellipsis> 七、IPv4数据报的首部格式 </span> </a> </li> <li class=md-nav__item> <a href=#icmp class=md-nav__link> <span class=md-ellipsis> 八、网际控制报文协议ICMP </span> </a> <nav class=md-nav aria-label=八、网际控制报文协议ICMP> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-icmp class=md-nav__link> <span class=md-ellipsis> 1. ICMP差错报文 </span> </a> </li> <li class=md-nav__item> <a href=#2-icmp class=md-nav__link> <span class=md-ellipsis> 2. ICMP询问报文 </span> </a> </li> <li class=md-nav__item> <a href=#3-icmp class=md-nav__link> <span class=md-ellipsis> 3. ICMP应用举例 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#vpnnat class=md-nav__link> <span class=md-ellipsis> 九、虚拟专用网VPN与网络地址转换NAT </span> </a> <nav class=md-nav aria-label=九、虚拟专用网VPN与网络地址转换NAT> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-vpn class=md-nav__link> <span class=md-ellipsis> 1. 虚拟专用网VPN </span> </a> </li> <li class=md-nav__item> <a href=#2-nat class=md-nav__link> <span class=md-ellipsis> 2. 网络地址转换NAT </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=_1>计算机网络「四」网络层<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <blockquote> <p>本文为计算机网络系列第四章笔记，陆续会更新余下内容。文章参考：<a href="https://www.bilibili.com/video/BV1c4411d7jb?p=32">计算机网络微课堂</a></p> </blockquote> <p><strong>系列文章：</strong></p> <ul> <li><a href="https://blog.csdn.net/qq_46331050/article/details/120118138?spm=1001.2014.3001.5501">计算机网络「一」计算机网络概述</a></li> <li><a href="https://blog.csdn.net/qq_46331050/article/details/120206230?spm=1001.2014.3001.5501">计算机网络「二」物理层</a></li> <li><a href="https://blog.csdn.net/qq_46331050/article/details/120240563?spm=1001.2014.3001.5501">计算机网络「三」数据链路层</a></li> </ul> <p><strong>需要说明：文章中图片多来自于网络和网课，本文只用作后期学习时参考。</strong></p> <p><strong>网络层知识预览</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253539224-a1cf57c5-2211-4760-aed3-8f848b207462.png></p> <h2 id=_2>一、网络层概述<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <ul> <li><strong>网络层的主要任务是实现网络互连，进而实现数据包在各网络之间的传输</strong></li> <li><strong>要实现网络层任务，需要解决以下主要问题：</strong></li> <li>网络层向运输层提供怎样的服务（“可靠”or“不可靠”）</li> <li>网络层寻址问题</li> <li>路由选择问题</li> <li><strong>因特网（Internet）是目前全世界用户数量最多的互连网，它使用TCP/IP协议栈</strong></li> <li><strong>由于TCP/IP协议栈的网络层使用网际协议IP，它是整个协议栈的核心协议，因此在TCP/IP协议栈中网络层常称为网际层</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253539213-94a4a2e1-e8e4-4656-9572-f41ead030656.png></p> <p><strong>下面，我们将基于TCP/IP协议栈的网际层来学习网络层的理论知识和实践技术。</strong></p> <h2 id=_3>二、网络层提供的两种服务<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p><strong>「一」面向连接的虚电路服务</strong></p> <ul> <li><strong>虚电路服务核心思想为可靠通信由网络来保证</strong></li> <li>两台计算机进行通信时必须建立网络层的连接——虚电路VC（Virtual Circuit）</li> <li>通信双方沿着已建立的虚电路发送分组</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253539216-5ffbc891-eea1-4fa5-88e4-7cde934a382a.png></p> <ul> <li>说明：虚电路是一条逻辑上的连接，并不是真正建立了一条物理连接</li> <li>目的主机的地址仅在连接建立阶段使用，之后每个分组的首部只需携带一条虚电路的编号（构成虚电路的每一段链路都有一个虚电路编号）</li> <li>这种方式如果再使用可靠传输的网络协议，就可使所发送的分组最终正确到达接收方（无差错按需到达、不丢失、不重复）</li> <li>通信结束后，需要释放之前所建立的虚电路</li> <li>很多广域分组交换网都使用面向连接的虚电路服务。例如，曾经的X.25和逐渐过时的帧中继FR、异步传输模式ATM等</li> </ul> <p><strong>「二」无连接的数据报服务</strong></p> <ul> <li><strong>数据报服务核心思想是可靠通信应由用户主机来保证</strong></li> <li>两台计算机进行通信时不需要建立网络层连接</li> <li>通信双方可以沿不同路径</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253539232-84089a12-c149-405f-9a5c-80490f4b0a0a.png></p> <ul> <li><strong>每个分组的首部必须携带目的主机的完整地址</strong></li> <li>这种通信方式所传送的分组可能误码、丢失、重复和失序</li> <li>由于网络本身不提供端到端的可靠传输服务，这就使网络中的路由器可以做得比较简单，而且价格低廉（与电信网的交换机相比）</li> <li><strong>因特网</strong>就采取了这种设计思想，将复杂的网络处理功能置于因特网的边缘（用户主机和其内部的运输层），而将相对简单的尽最大努力的分组交付功能置于因特网核心</li> </ul> <h2 id=ipv4>三、IPv4地址<a class=headerlink href=#ipv4 title="Permanent link">&para;</a></h2> <p><strong>IPv4地址概述</strong></p> <ul> <li><strong>IPv4地址就是给因特网上的每一台主机（或路由器）的每一个接口分配一个在全世界范围内是唯一的32比特标识符</strong></li> </ul> <blockquote> <p>网际协议版本4（英语：Internet Protocol version 4，IPv4），又称互联网通信协议第四版，是网际协议开发过程中的第四个修订版本，也是此协议第一个被广泛部署的版本。IPv4是互联网的核心，也是使用最广泛的网际协议版本，其后继版本为IPv6，直到2011年，IANA IPv4位址完全用尽时，IPv6仍处在部署的初期。——<a href=https://baike.baidu.com/item/IPv4>百度百科</a></p> </blockquote> <ul> <li><strong>IPv4地址的编码方法经历了如下三个历史阶段</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253539215-d01085d3-b01a-483c-9fcc-8720bda864d1.png></p> <p><strong>IPv4地址表述方法</strong></p> <p><strong>由于32比特的IPv4地址不方便阅读、记录以及输入等，因此IPv4地址采用点分十进制表示方法以方便用户使用</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253539790-a7da630a-a183-4c42-831b-afde7525b9eb.png></p> <p><strong>来个小练习</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253539779-57249d0c-941a-4da6-a634-3bd6cb779de0.png></p> <p><strong>8位无符号整数二进制与十进制转换问题</strong></p> <ul> <li><strong>二进制转十进制</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253539856-70799745-9579-496c-abd8-07055611265e.png></p> <ul> <li><strong>十进制转二进制</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253539729-3d94b1a3-2c1f-4e1b-a518-0e63cedb75cd.png></p> <p><strong>下面讲述IPv4编址的三个历史阶段，也就是三种方法：分类编址、划分子网、无分类编址</strong></p> <h3 id=1>1. 分类编址<a class=headerlink href=#1 title="Permanent link">&para;</a></h3> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253539851-dc96a543-a4d4-438c-bc67-2c6977ca2643.png></p> <ul> <li>只有A类、B类和C类地址可分配给网络中的主机或路由器的各接口</li> <li>主机号为“全0”的地址是网络地址，不能分配给主机或路由器的各接口</li> <li>主机号为“全1”的地址是广播地址，不能分配给主机或路由器的各接口</li> </ul> <p><strong>A类地址</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253540220-49dd7ca9-7209-49f3-9664-fab685d22e6d.png></p> <ul> <li><strong>说明：</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253540362-c74feaee-d9a4-447a-afac-32cf67243664.png></p> <ul> <li>可指派的网络数量为2^(8-1)-2=126</li> <li>每个网络中可分配的IP地址数量为2^24-2=16777214（去除主机号全0的网络地址、全1的广播地址）</li> </ul> <p><strong>B类地址</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253540403-47e90e19-afd0-45ab-b120-0aec04a55f81.png></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253540374-47d55b5a-ccdd-4ca4-966a-1edb06de453c.png></p> <ul> <li>可指派的网络数量为2^(16-2)=16384</li> <li>每个网络中可分配的IP地址数量为2^16-2=65534</li> </ul> <p><strong>注意：有些教材中指出128.0是保留网络号，B类第一个可指派的网络号为128.1。但根据2002年9月发表的RFC 3330文档，128.0网络号已经可以分配。</strong></p> <p><strong>C类地址</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253540472-e7f7506e-360b-48ae-b0dd-1ef538cf96ab.png></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253540829-f385ed5b-5369-4fef-b82d-416354e7a9ad.png></p> <ul> <li>可指派的网络数量为2^(24-3)=2097152</li> <li>每个网络中可分配的IP地址数量为2^8-2=254</li> </ul> <p><strong>注意：有些教材中指出192.0.0是保留网络号，C类第一个可指派的网络号为192.0.1。但根据2002年9月发表的RFC 3330文档，192.0.0网络号已经可以分配，只不过目前还没有分配出去</strong></p> <p><strong>分类编址——练习</strong></p> <ul> <li><strong>习题一</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253540941-86df015f-ec73-41df-b9cd-afce0d8d8e2f.png></p> <ul> <li><strong>习题二</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253541038-0075f2f3-dff5-4804-9d59-6c1f790f4c2d.png></p> <p><strong>下图为一般不使用的IP地址</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253540933-6d58bf22-4d0a-4781-b545-e343cd622cbe.png></p> <ul> <li><strong>习题三</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253541064-af29722b-b8f0-4105-b0ce-39016f7e292f.png></p> <h3 id=2>2. 划分子网<a class=headerlink href=#2 title="Permanent link">&para;</a></h3> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253541525-b35dc786-1d7a-4bf8-a325-3e060ed81d34.png></p> <p><strong>为将某一网络划分出多个子网，可以借用主机号中某几位作为子网号，计算机通过子网掩码来获得分类地址中有多少比特被用作子网号。</strong></p> <p><strong>子网掩码</strong></p> <ul> <li>32比特的子网掩码可以表明分类IP地址的主机号部分被借用了几个比特作为子网号</li> <li>子网掩码使用连续的比特1来对应网络号和子网号</li> <li>子网掩码使用连续的比特0来对应主机号</li> <li><strong>将划分子网的IPv4地址与其相应的子网掩码进行逻辑与(AND)运算就可得到IPv4地址所在子网的网络地址</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253541550-7b9fc61b-a542-4651-aa5b-1ff431618c1c.png></p> <ul> <li>若使用较少位数的子网号，则每一个子网上可连接的主机数就较多；若使用较多位数的子网号，则子网的数目较多但每个子网上可连接的主机数就较少</li> <li>划分子网增加了灵活性，但却减少了能够连接在网络上的主机总数</li> </ul> <p><strong>子网掩码——举例说明</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253541527-62ca56f1-facc-4496-a866-dab21d095445.png></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253541730-25d99718-79dc-47b2-8df3-caf4b11aa851.png></p> <p><strong>子网掩码——习题</strong></p> <ul> <li><strong>习题一</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253541743-42df6e1a-90d6-48e9-80d1-fe607aeb3502.png></p> <ul> <li><strong>习题二</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253542072-254dd2c8-3bf1-4ffd-abfe-fa007a5a783f.png></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253542289-331be159-5e52-47c5-aca8-889982bc10ec.png></p> <p><strong>默认子网掩码</strong></p> <p><strong>因特网的标准规定：所有的网络都必须使用子网掩码，同时在路由器的路由表中也必须有子网掩码这一栏；如果一个网络未划分子网，那么该网络的子网掩码就使用默认子网掩码。</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253542173-7c835b66-2151-49a7-8b32-1f9c81ff95ae.png></p> <p><strong>默认的子网掩码与网络号相与之后，网络号没有发生变化。</strong></p> <h3 id=3>3. 无分类编址<a class=headerlink href=#3 title="Permanent link">&para;</a></h3> <p><strong>先来一段背景知识</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253542473-30e75e5c-6304-4eb4-b901-8d8dc56ba90e.png></p> <p><strong>无分类域间路由选择CIDR</strong></p> <ul> <li><strong>CIDR使用"斜线记法"，或称CIDR记法。即在IPv4地址后面加上<code>/</code>，在斜线后面写上网络前缀所占比特数量</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253542423-8053cb57-8470-40f8-99fd-8d55a894a982.png></p> <ul> <li><strong>CIDR实际上是将网络前缀都相同的连续的IP地址组成一个"CIDR地址块"</strong></li> <li><strong>只要知道CIDR地址块中的任何一个地址，就可知道该地址块的全部细节</strong></li> <li>地址块的最小地址</li> <li>地址块的最大地址</li> <li>地址块的地址数量</li> <li>地址块聚合某类网络（A类、B类或C类）的数量</li> <li>地址掩码（子网掩码）</li> </ul> <p><strong>CIDR——举例说明</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253542690-afbe7bf5-c743-482f-b13b-99e9e3ea939a.png></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253542657-13cf4dbd-9158-42c1-b43b-028008d61dd0.png></p> <p><strong>CIDR——路由聚合（构造超网）</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253542911-474a4fee-ad0e-4c40-befe-e19ca8f5df69.png></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253542995-042bc45c-ee23-470f-91ab-121264efe202.png></p> <ul> <li><strong>网络前缀越长，地址块越小，路由越具体</strong></li> <li><strong>若路由器查表转发分组时发现有多条路由器可选，则选择网络前缀最长的那条，这称为最长前缀匹配，因为这样的路由更具体</strong></li> </ul> <p><strong>路由聚合（构造超网）——相关考研题</strong></p> <ul> <li><strong>习题一</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253543186-22ca4081-f54b-4bfb-b979-b87a261c1ebf.png></p> <ul> <li><strong>习题二</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253543360-be7d2dc5-d1e7-4a26-b29e-ce9330d08281.png></p> <h3 id=4>4. 应用规划<a class=headerlink href=#4 title="Permanent link">&para;</a></h3> <p><strong>给定一个IPv4地址块，如何将其划分成几个更小的地址块，并将这些地址块分配给互连网中的不同网络，进而可以给各网络中的主机和路由器接口分配IPv4地址。有两种方式：</strong></p> <ul> <li><strong>定长的子网掩码FLSM（Fixed Length Subnet Mask）</strong></li> <li>使用同一个子网掩码来划分子网</li> <li>每个子网所分配的IP地址数量相同，造成IP地址的浪费</li> <li><strong>变长的子网掩码VLSM（Variable Length Subnet Mask）</strong></li> <li>使用不同的子网掩码来划分子网</li> <li>每个子网所分配的IP地址数量可以不同，尽可能减少对IP地址的浪费</li> </ul> <p><strong>定长的子网掩码FLSM——举例说明</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253543430-592d05ed-2c5c-4821-8a56-e2d520ac292c.png></p> <p><strong>应用需求：将C类网络218.75.230.0划分成5个子网，每个子网上可分配的IP地址数量不得少于各自的需求</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253543423-345d7b36-5c5d-42fa-9cb6-9cc1fbabe65f.png></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253543632-46998f36-cff6-47b7-9f2e-f1776d8c1f96.png></p> <p><strong>从子网1<sub>8中任选5个分配给网络中的N1</sub>N5即可</strong></p> <p><strong>说明</strong></p> <ol> <li>采用定长的子网掩码进行子网划分，只能划分出2^n个子网，其中n是从主机号部分借用的用来作为子网号的比特数量</li> <li>每个子网分配的IP地址相同，容易造成IP地址的浪费</li> </ol> <p><strong>变长的子网掩码VLSM——举例说明</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253543756-72ee8418-0c88-4e47-9bf1-f57ae3370b8c.png></p> <p><strong>应用需求：从地址块218.75.230.0/24中取出5个地址块（1个"/27"地址块，3个"/28"地址块，1个"/30"地址块），按需分配给上图所示的5个网络。</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253543936-eefcd9ad-3ad8-4389-a0e3-30ede8413f7f.png></p> <h2 id=ip>四、IP数据报的发送和转发过程<a class=headerlink href=#ip title="Permanent link">&para;</a></h2> <ul> <li><strong>IP数据报的发送和转发过程包含以下两部分：</strong></li> </ul> <p><strong>1.主机发送IP数据报</strong> <strong>2.路由器转发IP数据报</strong></p> <p><strong>说明：后续举例忽略了ARP协议获取目的主机或路由器接口的MAC地址的过程以及以太网交换机自学习和转发帧的过程</strong></p> <p><strong>IP数据报的发送和转发过程——举例说明</strong></p> <p>如图所示小型互连网，路由器接口0和接口1分别直连一个交换式以太网，网络地址和子网掩码如图所示：</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253544015-f92a6245-237b-4b9d-a2f4-49363ca555f7.png></p> <ul> <li><strong>同一个网络中的主机可以直接通信，这属于直接交付；不同网络间的主机，需要路由器中转，这属于间接交付</strong></li> </ul> <p><strong>问题1：那么，源主机如何判断目的主机是否与自己在同一个网络中呢？</strong></p> <p>假设主机C向主机F发送IP数据报。首先，主机C将自己的IP地址和子网掩码相与，得到主机C所在网络的网络地址。之后，主机C将主机F的IP地址与自己的子网掩码相与，得到目的网络地址。发现它们两个不相等，因此知道这是间接交付，需要路由器转发。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253544212-46890fa1-4976-484d-9ada-f27594e0aa0f.png></p> <p><strong>问题2：源主机如何知道路由器的存在？</strong></p> <p>这就涉及到了<strong>默认网关</strong>。可以通过指定路由器某接口的IP地址指定给各主机，所指定的路由器就被称为默认网关。</p> <blockquote> <p>缺省网关（Default Gateway），也就是默认网关，是子网与外网连接的设备，通常是一个路由器。当一台计算机发送信息时，根据发送信息的目标地址，通过子网掩码来判定目标主机是否在本地子网中，如果目标主机在本地子网中，则直接发送即可。如果目标不在本地子网中则将该信息送到缺省网关/路由器，由路由器将其转发到其他网络中，进一步寻找目标主机。——<a href="https://baike.baidu.com/item/%E7%BC%BA%E7%9C%81%E7%BD%91%E5%85%B3?fromtitle=%E9%BB%98%E8%AE%A4%E7%BD%91%E5%85%B3&fromid=2152622">百度百科</a></p> </blockquote> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253544328-b817b416-8369-4768-8cdc-93795e708391.png></p> <p><strong>问题3：路由器收到IP数据报后如何转发？</strong></p> <ol> <li>首先，检查数据报首部是否出错：若出错，则直接丢弃该IP数据报并通告源主机；若没有出错，则进行转发</li> <li>之后，根据IP数据报的目的地址在路由表中查找匹配的条目：若找到匹配的条目，则转发给条目中指示的下一跳；若找不到，则丢弃该IP数据报并通告源主机</li> </ol> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253544341-56ba1bbb-ece8-48cb-b4fd-07f45c4c6b99.png></p> <p><strong>下面来看发送广播IP数据报的情况</strong></p> <ol> <li>假设主机A给本网络上各设备发送了一个广播IP数据报。</li> </ol> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253544567-c2e1d122-22c7-4c9c-ad7d-d1ff437ed61e.png></p> <p>路由器是隔离广播域的，收到后不会转发广播IP数据报，避免了广播风暴和资源浪费</p> <ol> <li>假设主机A向另一个网络发送广播IP数据报。</li> </ol> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253544548-bc0711a8-8e8b-4829-adcb-d10f6da66087.png></p> <p>路由器判断出这是广播IP数据报，不对其进行转发</p> <p><strong>相关练习题</strong></p> <ul> <li><strong>习题一</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253544888-6b9bdf11-a09c-46a1-8885-f1697a24bb77.png></p> <ul> <li><strong>习题二</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253544961-e2eb314b-cbe9-452f-ad0c-40fedd3ba6ff.png></p> <ul> <li><strong>习题三</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253545076-64355bcd-4573-46ad-a6e9-88a4404b6ebf.png></p> <h2 id=_4>五、静态路由配置及路由环路问题<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <h3 id=1_1>1. 静态路由配置<a class=headerlink href=#1_1 title="Permanent link">&para;</a></h3> <ul> <li><strong>静态路由配置是指用户或网络管理员使用路由器的相关命令给路由器人工配置路由表</strong></li> <li>这种人工配置方式简单、开销小。但不能及时适应网络状态（流量、拓扑等）的变化</li> <li>一般只在小规模网络中采用</li> <li><strong>使用静态路由配置可能出现以下导致产生路由环路的错误</strong></li> <li>配置错误</li> <li>聚合了不存在的网络</li> <li>网络故障</li> </ul> <p><strong>静态路由配置——举例说明</strong></p> <p>采用如图所示的网络拓扑和相应的IP地址配置</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253545162-aa6d3a7e-b2ab-4795-b6a7-88b56238c0f5.png></p> <p><strong>假设R1要转发一个IP数据报给如图所指网络中某个主机，应该怎么操作呢？</strong></p> <p>首先，R1将IP数据报转发给路由器R2的接口0，但R1的路由表中并没有该目的网络的路由条目。因此，我们可以使用路由器的相关配置命令，给R1添加一条到达该目的网络的路由条目。该路由条目即为我们人工配置的静态路由。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253545230-55e6fcda-2e78-45d7-960f-5b8193c2db5f.png></p> <p><strong>默认路由——举例说明</strong></p> <p>如图所示，路由器R2的接口2连接到了因特网。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253545529-ccd08576-7c97-495b-b17d-ecce1eddd284.png></p> <p><strong>R1如何转发IP数据报到包含众多网络的因特网呢？</strong></p> <p>首先，R1需要将该IP数据报转发给路由器R2的接口0。由于因特网中包含了众多的网络，如果给R1添加针对这些网络的每一条路由条目，则会产生巨大工作量，且查表转发速度会降低。这就涉及到了<strong>默认路由</strong>。</p> <blockquote> <p>默认路由（Default route），是对IP数据包中的目的地址找不到存在的其他路由时，路由器所选择的路由。目的地不在路由器的路由表里的所有数据包都会使用默认路由。这条路由一般会连去另一个路由器，而这个路由器也同样处理数据包:如果知道应该怎么路由这个数据包，则数据包会被转发到已知的路由；否则，数据包会被转发到默认路由，从而到达另一个路由器。每次转发，路由都增加了一跳的距离。——<a href="https://baike.baidu.com/item/%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1/8990860?fr=aladdin">百度百科</a></p> </blockquote> <ul> <li><strong>默认路由条目中的目的网络地址为0.0.0.0，地址掩码也为0.0.0.0，其CIDR形式为0.0.0.0/0</strong></li> </ul> <p>对于本例，我们可以人工配置默认路由，来实现转发到互连网的目的。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253545585-142a7aa1-c2aa-4865-ac5d-f1c1349c8ef6.png></p> <p><strong>特定主机路由——举例说明</strong></p> <p><strong>我们可以给路由器添加针对某个主机的特定主机路由条目，一般用于网络管理人员对网络的管理和测试。此外，在需要考虑某种安全问题时，也可采用特定主机路由。</strong></p> <p>如图所示为人工配置的特定主机路由</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253545694-dc67bf05-6778-4313-b645-b86ad2cd4554.png></p> <ul> <li><strong>特定主机中的目的网络地址为该特定主机的IP地址，地址掩码为255.255.255.255，其CIDR形式为特定主机IP地址/32</strong></li> </ul> <h3 id=2_1>2. 环路问题<a class=headerlink href=#2_1 title="Permanent link">&para;</a></h3> <p><strong>下面介绍路由环路问题</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253545770-2be289b6-d3d8-4ae7-8607-eaa63e405e07.png></p> <p><strong>静态路由配置错误导致路由环路——举例说明</strong></p> <p><strong>所谓路由环路，就是指数据包不断在这个网络传输，始终到达不了目的地，导致掉线或者网络瘫痪。</strong></p> <p>如图所示，由于静态路由配置错误，原本下一跳为R1的接口1错误配置成了R3的接口0，使得R2和R3之间产生路由环路。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253545815-a3964f7b-9854-4443-9442-2b2130925494.png></p> <p><strong>如何解决数据报在路由环路中永久兜圈的问题呢？</strong></p> <p>在IP数据报首部设有<strong>生存时间TTL</strong>字段。IP数据报进入路由器后，TTL字段的值减1。若TTL的值不等于0，则被路由器转发，否则被丢弃。</p> <p><strong>聚合了不存在的网络导致路由环路——举例说明</strong></p> <p>如图所示，假设R2要转发IP数据报到192.168.2.0/24，但是因为聚合网络问题，会向4个网络进行转发，而其中两个目的网络地址无法在R1的路由表中查找到，则会转发到默认网关（即R2），因此形成了路由环路。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253546148-c86e12b6-1a53-4748-b6eb-74bbbd69c1db.png></p> <p><strong>为解决这种情况下的路由环路问题，涉及到了黑洞路由，其下一跳为null0</strong></p> <p>在R2的路由表中添加黑洞路由，将所有无关路由吸入其中，使它们有来无回。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253546287-c6b1b177-53fc-4556-b852-1a1c45be7306.png></p> <p><strong>网络故障导致路由环路——举例说明</strong></p> <p>如图所示，路由器R1检测到其接口0所直连的网络出现了故障而不可达，在其路由表中删除对应的路由条目。当R2向其转发IP数据包时，无法查找到，因此会转发给默认路由。这就又回到了R2本身，造成路由环路。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253546377-41f0e689-8aa9-429c-b6c6-50069df83f73.png></p> <p><strong>为解决这种情况下的路由环路问题，同样要利用黑洞路由：</strong></p> <p>将故障部分的路由设置为黑洞路由</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253546384-e623261e-60f4-450d-8035-68e8e84936e4.png></p> <h2 id=_5>六、路由选择<a class=headerlink href=#_5 title="Permanent link">&para;</a></h2> <h3 id=1_2>1. 路由选择协议概述<a class=headerlink href=#1_2 title="Permanent link">&para;</a></h3> <p><strong>路由选择可分为静态路由选择和动态路由选择两类</strong></p> <ul> <li><strong>静态路由选择</strong></li> <li><strong>由人工配置的网络路由、默认路由、特定主机路由、黑洞路由等都属于静态路由</strong></li> <li>这种人工配置方式简单、开销小。但不能及时适应网络状态（流量、拓扑等）的变化</li> <li>一般只在小规模网络中采用</li> <li><strong>动态路由选择</strong></li> <li><strong>路由器通过路由选择协议自动获取路由信息</strong></li> <li>比较复杂、开销比较大。但能较好地适应网络状态变化</li> <li>适用于大规模网络</li> </ul> <p><strong>因特网所采用的路由选择协议的主要特点</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253546579-08194050-0a6e-4528-a82c-f83fd09e02fe.png></p> <p><strong>因特网采用分层次的路由选择协议</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253546822-730e2cf3-ccd1-4887-bc3d-ce22a65beb29.png></p> <ul> <li><strong>自治系统</strong></li> </ul> <p>自治系统（Autonomous System，AS）：单一技术管理下的一组路由器，这些路由器使用一种AS内部的路由选择协议和共同的度量来确定分组在该AS内的路由，同时还使用一种AS之间的路由选择协议来确定分组在AS之间的路由。</p> <ul> <li><strong>域内路由、域间路由</strong></li> </ul> <p>自治系统内部的路由选择称为域内路由选择，自治系统之间的路由选择称为域间路由选择。</p> <ul> <li><strong>因特网有两大类路由选择协议</strong></li> <li><strong>内部网关协议IGP：</strong>内部网关协议即在一个自治系统内部使用的路由选择协议，它与互连网中其他自治系统选用什么路由选择协议无关。目前这类路由选择协议使用得最多，如RIP和OSPF。</li> <li><strong>外部网关协议EGP：</strong>若源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时（两个自治系统可能使用不同的IGP），就需要使用外部网关协议协议将路由选择信息传递到另一个自治系统。目前使用最多的外部网关协议是BGP-4。</li> </ul> <p><strong>常见的路由选择协议</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253546832-709f5016-c802-4b22-a1f7-7b5114be72ca.png></p> <p><strong>路由器的基本结构</strong></p> <p><strong>路由器是具有多个输入端口和输出端口的专用计算机，其任务是转发分组，整个路由器结构可划分为两大部分：路由选择部分和分组转发部分</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253546833-ff5d80a0-f587-4383-90dd-a79076a6a302.png></p> <ol> <li>路由选择部分的核心构件是路由选择处理机。它的任务是根据所使用的路由选择协议周期性地与其他路由器进行路由信息的交互来更新路由表。</li> <li>分组转发部分由三部分构成：交换结构、一组输入端口、一组输出端口。下面分析过程：</li> </ol> <p>信号从某个输入端口进入路由器，物理层将其转为比特流送往数据链路层处理；数据链路层从比特流中识别出帧，去掉帧头帧尾后，送交网络层处理。 1）如果送交网络层的分组是普通待转发的数据分组，则根据分组首部中的目的地址进行查表转发，网络层更新数据分组首部中某些字段的值，然后送交数据链路层进行封装，数据链路层将数据分组封装成帧，送交物理层处理，物理层将帧看作比特流，将其变成相应电信号发送。 2）如果送交网络层的分组是路由器间交换路由信息的路由报文，则把这种分组送交路由选择处理机，路由选择处理机根据分组的内容来更新自己的路由表。</p> <ol> <li>路由表一般仅包含从目的网络到下一跳的映射。路由表需要对网络拓扑变化的计算最优化。转发表是从路由表得出的。转发表的结构应当使查找过程最优化。(为简化问题，我们暂且不严格区分路由表、转发表，以路由表来表述）</li> <li>路由选择处理机除了处理收到的路由报文外，还会周期性地给其他路由器发送自己所知道的路由信息</li> <li>路由器的各端口还应具有输入缓冲区和输出缓冲区。输入缓冲区用于暂存新进入路由器但还来不及处理的分组。输出缓冲区用来暂存已经处理完毕但还来不及发送的分组</li> </ol> <p>说明：路由器的端口一般都具有输入和输出功能，图中区分输入和输出是为了更好地展示</p> <h3 id=2-rip>2. 路由信息协议RIP<a class=headerlink href=#2-rip title="Permanent link">&para;</a></h3> <p><strong>路由信息协议（Rounting Information Protocol，RIP）是内部网关协议IGP中最先得到广泛的协议。RIP是一种分布式的基于距离向量的路由选择协议。</strong></p> <p><strong>RIP规定</strong></p> <ul> <li><strong>RIP要求自治系统AS内的每一个路由器都要维护从它自己到AS内其他每一个网络的距离记录。这是一组距离，称为"距离向量D-V（Distance Vector）"</strong></li> <li><strong>RIP使用跳数（Hop Count）作为度量来衡量到达目的网络的距离</strong></li> <li>路由器到直连网络的距离（跳数）定义为1</li> <li>路由器到非直连网络的距离定义为所经过的路由器数加1</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253546904-3bada5b0-e502-46ab-9cd7-c463b394d122.png></p> <ol> <li><strong>允许一条路径最多只能包含15个路由器（至多15跳）。距离等于16时相当于不可达，可见RIP只适用于小型互联网</strong></li> </ol> <p><strong>RIP特点</strong></p> <ul> <li><strong>RIP认为好的路由就是"距离短"的路由，也就是所通过路由器数量最少的路由</strong></li> <li><strong>当到达同一目的网络有多条"距离相等"的路由时，可以进行等价负载均衡，将通信量分布到多条等价路由上</strong></li> <li><strong>RIP包含三个要点：</strong></li> <li>和谁交换信息——<strong>仅和相邻路由器交换信息</strong></li> <li>交换什么信息——<strong>自己的路由表</strong></li> <li>何时交换信息——<strong>周期性交换（例如每隔30秒）</strong></li> </ul> <p><strong>RIP基本工作工程——举例说明</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253547050-efc09614-0794-482d-a155-c9c7c8e22b26.png></p> <ol> <li><strong>路由器刚开始工作时，只知道自己到直连网络的距离为1</strong></li> <li><strong>每个路由器仅和相邻路由器周期性地交换并更新路由信息</strong></li> <li><strong>若干次交换和更新后，每个路由器都知道到达本AS内各网络的最短距离和下一跳地址，称为收敛</strong></li> </ol> <p><strong>RIP路由条目的更新规则——举例说明</strong></p> <p>如下图，路由器C和D互为相邻路由器，它们之间周期性交换并更新路由信息。下图为更新路由信息前的情况：</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253547483-dc91c24e-d31b-435b-9270-db0c9cd0770a.png></p> <p>路由器D接收到更新报文后，D的路由表将进行更新</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253547702-300ed9a3-50cd-4b05-b9f5-9a7bdcc60ee3.png></p> <p><strong>相关考研题</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253547611-5dc92d21-7088-457f-b158-0a184b55ff39.png></p> <p><strong>RIP存在"坏消息传得慢"问题</strong></p> <p><strong>网络出现故障时，会出现慢收敛现象（即需要较长时间才能将此信息传送到所有路由器），俗称"坏消息传得慢"，使更新过程的收敛时间长。</strong></p> <p>如下图，假设R1到达其直连网络N1的链路出现了故障。当R1检查出该故障后，会将到达N1的路由条目中距离改为16，表示不可达。并等待RIP更新周期到时后，发送该路由信息给R2。但是，如果R2抢先一步将自己的路由信息发送给了R1，则会出现下面问题：</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253547531-15023e2b-3669-4f8e-93db-2c4a1a00fd63.png></p> <ul> <li><strong>"坏消息传得慢"又称为路由环路或无穷计数问题，这是距离向量算法的一个固有问题。可以采用多种措施减少该问题出现的概率或减小该问题的危害</strong></li> <li>限制最大路径距离为15（16表示不可达）</li> <li>当路由表发生变化时就立即发送更新报文（即，触发更新），而不仅是周期性发送</li> <li>让路由器记录收到某特定路由信息的接口，而不让同一路由信息再通过此接口反方向传送（即，水平分隔）</li> <li><strong>即使采用上述算法路由环路问题也无法彻底避免，这是距离向量算法的本质所决定的</strong></li> </ul> <p><strong>相关考研题</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253547553-1945af63-78db-4cf2-be1a-f969ed296ddd.png></p> <h3 id=3-ospf>3. 开放最短路径优先OSPF<a class=headerlink href=#3-ospf title="Permanent link">&para;</a></h3> <p><strong>开放最短路径优先OSPF，是为克服RIP缺点开发出来的，是使用分布式链路状态路由算法的典型代表，也是内部网关协议IGP的一种</strong></p> <ul> <li>开放：表明OSPF协议不是受某一厂家控制，而是公开发表的</li> <li>最短路径优先：因为使用了Dijkstra提出的最短路径算法SPF</li> </ul> <p><strong>OSPF特点</strong></p> <ul> <li><strong>OSPF是基于链路状态的，而不像RIP那样是基于距离向量的</strong></li> <li><strong>OSPF采用SPF算法计算路由，从算法上保证了不会产生路由环路</strong></li> <li><strong>OSPF不限制网络规模，更新效率高，收敛速度快</strong></li> </ul> <p><strong>链路状态</strong></p> <ul> <li><strong>链路状态是指本路由器都和哪些路由器相连，以及相应链路的"代价"</strong></li> <li><strong>代价：用来表示费用、距离、时延、带宽等，由网络管理人员决定</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253547934-064d961d-065c-4819-aa6d-ef1bae7761c8.png></p> <p><strong>问候分组Hello</strong></p> <p><strong>OSPF相邻路由器之间通过交互问候（Hello）分组，建立和维护邻居关系</strong></p> <ul> <li><strong>Hello分组封装在IP数据报中，发往组播地址224.0.0.5</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253547992-8a899047-4fb7-4636-a367-8b66dbe43890.png></p> <ul> <li><strong>问候分组的发送周期为10秒</strong></li> <li><strong>若40秒未收到来自邻居路由器的Hello分组，则认为该邻居路由器不可达</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253548146-f143dd8e-f60e-4014-8384-dc78874b5582.png></p> <p><strong>OSPF基本工作原理</strong></p> <p><strong>使用OSPF的每个路由器都会产生链路状态通告LSA。LSA中包含以下内容：</strong></p> <ul> <li><strong>直连网络的链路状态信息</strong></li> <li><strong>邻居路由器的链路状态信息</strong></li> </ul> <p><strong>LSA被封装在链路状态更新分组LSU中，采用洪泛法发送</strong></p> <ul> <li>洪泛法是一种简单的路由算法，将收到的封包，往所有的可能连结路径上递送，直到封包到达为止</li> <li>收到链路状态更新分组的路由器，将从自己其他所有接口转发该分组</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253548202-ceff208f-f2b5-4316-83ae-7ded98ee4918.png></p> <p><strong>使用OSPF的每个路由器都有一个链路状态数据库LSDB，用于存储LSA。通过各路由器洪泛发送封装有自己LSA的LSU分组，各路由器的LSDB最终将达到一致。</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253548328-c8c2e3f1-2075-4ae6-9870-fcc30785bd13.png></p> <p><strong>使用OSPF的各路由器基于LSDB进行最短路径优先SPF计算，构建出各自到达其他各路由器的最短路径，即构建各自的路由表。</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253548452-a5ae010a-e4fb-4ba8-bcc8-7200b7b3a55e.png></p> <p><strong>OSPF五种分组类型</strong></p> <ul> <li><strong>问候分组：用来发现和维护邻居路由器的可达性</strong></li> <li><strong>数据库描述分组：向邻居路由器给出自己的链路状态数据库中的所有链路状态项目的摘要信息</strong></li> <li><strong>链路状态请求分组：向邻居路由器请求发送某些链路状态项目的详细信息</strong></li> <li><strong>链路状态更新分组：用洪泛法对全文更新链路状态</strong></li> <li><strong>链路状态确认分组：对链路状态更新分组的确认</strong></li> </ul> <p><strong>OSPF的基本工作过程——举例说明</strong></p> <p><strong>相邻路由器之间周期性发送问候分组，以便建立和维护邻居关系。建立邻居关系后，给邻居路由器发送数据库描述分组，也就是将自己的链路状态数据库中的所有链路状态项目的摘要信息发送给邻居路由器。</strong></p> <ol> <li>例如，R1收到R2的数据库描述分组后，发现自己缺少其中的某些链路状态项目，于是就给R2发送链路状态请求分组。R2收到后，将R1所缺少的链路状态项目的详细信息封装在链路状态更新分组中发送给R1。</li> <li>R1收到后，将这些缺少的链路状态项目的详细信息添加到自己的链路状态数据库中，并给R2发送链路状态确认分组。</li> <li>最终R1和R2的链路状态数据库将达到一致，也就是<strong>链路状态数据库达到同步</strong>。</li> </ol> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253548675-480fe2a1-b159-42f7-a995-b15b7c7ec51a.png></p> <p><strong>此外，每隔30分钟或者链路状态发生变化时，路由器都会发送链路状态更新分组。收到该分组的其他路由器将洪泛转发该分组，并给该路由器发回链路状态确认分组。这就称为新情况下的链路状态数据库同步。</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253548675-3680be4c-e622-43e6-8f14-8054b8bbc7bb.png></p> <p><strong>OSPF在多点接入网络中路由器邻居关系的建立</strong></p> <p><strong>当OSPF路由器在多点接入网络中建立邻居关系时，如果不采用其他机制，将会产生大量多播分组。</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253548921-6dfa7ccc-776a-4050-9185-93f157d903ed.png></p> <p><strong>为了减少所发送分组的数量，OSPF采用选举指定路由器DR和备用的指定路由器BDR的方法。</strong></p> <ul> <li><strong>所有的非DR/BDR只与DR/BDR建立邻居关系</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253549033-50832493-0acf-44a8-9d74-e580da74c27b.png></p> <ul> <li><strong>非DR/BDR之间通过DR/BDR交换信息</strong></li> </ul> <p><strong>区域</strong></p> <p><strong>为了使OSPF能够用于规模更大的网络，OSPF把一个自治系统再划分为若干更小的范围，叫做区域。</strong></p> <ul> <li>每个区域都有一个32比特的区域标识符，可以用点分十进制表示</li> <li>主干区域的标识符必须为0。主干区域用于连通其他区域，其他区域标识符不能为0，且互不相同</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253549013-507ca0b0-081c-49e5-ac4b-67e379451ca6.png></p> <p><strong>划分区域的好处就是，将利用洪泛法交换链路状态信息的范围局限于每个区域而非整个自治系统，减少了整个网络上的通信量。</strong></p> <ul> <li>使得每个区域内部交换路由信息的通信量大大减少，因而使OSPF协议能够用于规模很大的自治系统中</li> </ul> <h3 id=4-bgp>4. 边界网关协议BGP<a class=headerlink href=#4-bgp title="Permanent link">&para;</a></h3> <p><strong>内部网关协议IGP（如RIP、OSPF）</strong></p> <ul> <li>设法使分组在同一个自治系统内尽可能有效地从源网络传输到目的网络</li> <li>无需考虑自治系统外部其他方面的策略</li> </ul> <p><strong>外部网关协议EGP（如BGP）</strong></p> <ul> <li>在不同自治系统内，度量路由的"代价"（距离、带宽、费用等）可能不同。由于没有统一的度量，因此寻找最佳路由是不现实的</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253549254-216dee9d-c494-425d-9601-f415407674c3.png></p> <ul> <li>自治系统之间的路由选择必须考虑相关策略（政治、经济、安全等）</li> </ul> <p><strong>考虑到上述环境，BGP只能是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子），而非寻找一条最佳路由。</strong></p> <p><strong>BGP工作原理</strong></p> <p><strong>在配置BGP时，每个自治系统的管理员要选择至少一个路由器作为该自治系统的"发言人"</strong></p> <ul> <li>一般来说，两个BGP发言人都是通过一个共享网络连接在一起的</li> <li>BGP发言人往往就是BGP边界路由器</li> </ul> <p><strong>不同自治系统的BGP发言人要交换路由信息，首先必须建立TCP连接，端口号179（可见BGP报文是通过TCP传送的，也就是作为TCP报文的数据部分）</strong></p> <ul> <li><strong>在此TCP连接上交换BGP报文以建立BGP会话</strong></li> <li><strong>利用BGP会话交换路由信息（如，增加新的路由、撤销过时路由、报告出错情况等）</strong></li> <li>使用TCP连接交换路由信息的两个BGP发言人，彼此称为对方的邻站或对等站</li> </ul> <p><strong>BGP发言人除了运行BGP外，还需要运行自己所在自治系统所使用的内部网关协议IGP（如RIP或OSPF）。</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253549231-ce7afebd-7cd3-4107-ad80-49309cc9665b.png></p> <p><strong>BGP发言人交换网络可达性的信息（要到达某个网络所要经过的一些列自治系统）。</strong></p> <p><strong>当BGP发言人互相交换了网络可达性的信息后，各BGP发言人就根据所采用的策略从收到的路由信息中找出到达各自治系统的较好的路由。也就是构造出树形结构、不存在回路的自治系统连通图。</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253549575-543ba3f8-7216-4a97-b057-af068c43c9f0.png></p> <p><strong>BGP适用于多级结构的因特网</strong></p> <p>下面给出一个BGP发言人交换路径向量的例子：</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253549598-13a52d9e-23a7-4ba1-ad17-f758104bf1d4.png></p> <p><strong>BGP-4共使用4种报文</strong></p> <ul> <li><strong>打开（Open）报文：用来与相邻的另一个BGP发言人建立关系，使通信初始化</strong></li> <li><strong>更新（Update）报文：用来通告某一路由的信息，以及列出要撤销的多条路由</strong></li> <li><strong>保活（Keepalive）报文：用来周期性证实邻站的连通性</strong></li> <li><strong>通知（Notification）报文：用来发送检测到的差错</strong></li> </ul> <p><strong>相关习题</strong></p> <ul> <li><strong>习题一</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253549798-f77f14e2-fff2-457d-ad13-beb602edcd60.png></p> <ul> <li><strong>习题二</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253549866-877ab75e-0294-4aa4-b867-ec1500aeba00.png></p> <h2 id=ipv4_1>七、IPv4数据报的首部格式<a class=headerlink href=#ipv4_1 title="Permanent link">&para;</a></h2> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253549880-87eeb4b7-5e81-489b-9ea6-892755d7ef71.png></p> <p>IP首部的部分重要字段含义如下：</p> <ul> <li><strong>版本</strong>：占4比特，表示IP协议的版本。通信双方使用的IP协议版本必须一致。目前广泛使用的版本号为4（IPv4）。</li> <li><strong>首部长度</strong>：占4比特，表示IP数据报首部的长度。该字段的取值以4字节（32位）为单位。</li> <li>最小十进制取值为5，表示IP数据报首部只有20字节固定部分</li> <li>最大十进制取值为15，表示IP数据报首部包含20字节固定部分和最大40字节可变部分</li> <li><strong>可选字段</strong>：长度从1个字节到40个字节不等。用来支持排错、测量及安全等措施。</li> <li>可选字段增加了IP数据报的功能，但这同时也使得IP数据报的首部长度成为可变的。这就增加了每一个路由器处理IP数据报的开销。实际上可选字段很少被使用</li> <li><strong>填充字段</strong>：确保首部长度为4字节的整数倍。使用全0填充。</li> <li>当IP分组的首部长度不是4字节的整数倍时，必须利用最后的填充字段加以填充。使得IP数据报的数据部分永远在4字节的整数倍开始，这样在实现IP协议时较为方便</li> <li><strong>区分服务</strong>：占8比特，用来获得更好的服务。</li> <li>该字段在旧标准中叫做服务类型，但实际上一直没有被使用过</li> <li>1998年，因特网工程任务组IETF把这个字段改名为区分服务</li> <li>利用该字段的不同数值可提供不同等级的服务质量</li> <li>只有在使用区分服务时，该字段才起作用。一般情况下都不使用该字段</li> <li><strong>总长度</strong>：占16比特，表示IP数据报的总长度（首部+数据载荷）</li> <li>最大取值为十进制的65535，以字节为单位</li> <li>举例：首部长度和总长度</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253550131-3ea62ff0-0fe5-438b-b1c1-56f3dd990331.png></p> <p><strong>下面介绍一下标识、标志、片偏移。这三个字段共同用于IP数据报分片。</strong></p> <p>如果某个IP数据报的长度超过最大传输单元时，将无法封装成帧，需要将原IP数据报分片成更小的IP数据报，再将各IP数据报封装成帧。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253550305-9dcd8dd6-3682-490b-9474-67cea4d47330.png></p> <blockquote> <p>最大传输单元（Maximum Transmission Unit，MTU）用来通知对方所能接受数据服务单元的最大尺寸，说明发送方能够接受的有效载荷大小。</p> <p>以太网和802.3对数据帧的长度都有一个限制，其最大值分别是1500字节和1492字节。</p> </blockquote> <ul> <li><strong>标识字段</strong>：占16比特，属于同一个数据报的各分片数据报应该具有相同的标识。</li> <li>IP软件维持一个计数器，每产生一个数据报，计数器值加1，并将此值赋给标识字段</li> <li><strong>标志</strong>：占3比特，各比特含义如下：</li> <li><strong>DF位</strong>：标志字段的中间一位。1表示不允许分片；0表示允许分片</li> <li><strong>MF位</strong>：标志字段中的最低位。1表示"后面还有分片"；0表示"这是最后一个分片"</li> <li>保留位：必须设置为0</li> <li><strong>片偏移</strong>：占13比特，指出分片数据报的数据载荷部分偏移其在原数据报的位置有多少个单位。</li> <li>片偏移以8个字节位单位</li> <li>除最后一个数据报片外，每个分片的长度一定是8字节（64位）的整数倍</li> </ul> <p><strong>IP数据报如何分片？——举例说明</strong></p> <p>假设如下IP数据报，它由20字节的固定首部和3800字节的数据载荷两部分构成。。假设使用以太网传送该IP数据报。以太网的最大传送单元MTU为1500字节，无法封装，因此进行切片处理。</p> <p>于是分为3个数据报片，其数据部分的长度分别为1400、1400和1000字节。原始数据报首部被复制为各数据报片的首部，但必须修改有关字段的值。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253550352-f18d3ad7-2498-4a1b-b424-70ac586a1dab.png></p> <hr> <ul> <li><strong>生存时间TTL</strong>：占8比特，最初以秒为单位，最大生存周期为255秒；路由器转发IP数据报时，将IP数据报首部中的该字段的值减去IP数据报在本路由器上所耗费的时间，若不为0就转发，否则就丢弃。</li> <li>随着技术进步，现在把TTL字段的功能改为跳数限制，路由器在每次转发IP数据报时，将IP数据报首部中的TTL的值减1，若该值不为0就转发，否则就丢弃</li> <li><strong>协议</strong>：占8比特，指明IPv4数据报的数据部分是何种协议数据单元。</li> <li>常用的一些协议和相应的协议字段值如下表</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253550445-f5f4ffaa-c968-4e7a-9c1a-bda391910c51.png></p> <ul> <li><strong>首部检验和</strong>：占16比特，用来检测首部（不包括数据部分）在传输过程中是否出现差错。所采用的检错码比CRC检验码简单，称为因特网检验和。</li> <li>IP数据报每经过一个路由器，路由器都要重新计算首部检验和，因为某些字段（生存时间、标志、片偏移等）的取值可能发生变化</li> <li><strong>源IP地址和目的IP地址</strong>：各占32比特，用来填写发送该IP数据报的源主机的IP地址和接收该IP数据报的目的主机的IP地址。</li> </ul> <p><strong>相关练习题</strong></p> <ul> <li><strong>习题一</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253550494-e3f363a7-3c19-486c-b676-787112275929.png></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253550845-0815c789-e1b4-4f79-b93a-cd64279cf816.png></p> <p>注意：除最后一个数据报片外，每个分片的长度一定是8字节（64位）的整数倍</p> <ul> <li><strong>习题二</strong></li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253550903-3624ef56-1a0e-4fb6-9b59-5f565500aaba.png></p> <p><strong>解析：</strong></p> <p>1）Web请求在网际层被封装在IP分组的数据部分，Web服务器的IP地址就填写在IP分组首部中的目的IP地址字段。IP分组还要封装成以太网帧才能发送。在IP分组头中，目的IP地址字段前还有16个字节的内容。在以太网帧中，数据载荷前还有14个字段的内容。因此可知，在以太网帧中，从第31个字节开始的4个字节，实际上就是IP地址的内容。</p> <p>题目中所给的以太网数据帧的第一列数据，实际上并不是以太网帧的内容，仅仅作为行号，其增量16，表示每行有16个字节的内容。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253551014-ecb1b02a-2f3f-4dd8-b468-6b52b34e738a.png></p> <p>由此，Web服务器的IP地址为64.170.98.32。</p> <p>2）从图中可知，主机的默认网关就是路由器R，主机会将Web请求发送给默认网关，由默认网关将Web请求转发到因特网。因此，以太网头中的目的MAC地址字段，封装的就是默认网关的MAC地址。具体为00-21-27-21-51-ee。</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253551010-28f82801-8c7d-454a-ab79-0dbad7f1578c.png></p> <p>3）IP分组经过路由器R时，生存时间字段被减1；首部检验和会被重新计算；若IP分组总长度大于MTU，则需要进行分片，此时总长度字段、标志字段、片偏移字段都需要修改。</p> <p>此题有些复杂，但是仔细探讨一下还是有挺多收获的。</p> <h2 id=icmp>八、网际控制报文协议ICMP<a class=headerlink href=#icmp title="Permanent link">&para;</a></h2> <p><strong>为了更有效地转发IP数据报和提高交付成功的机会，在网际层使用了网际控制报文协议ICMP（Internet Control Message Protocol）。</strong></p> <ul> <li><strong>主机或路由器使用ICMP来发送差错报告报文和询问报文</strong></li> <li><strong>ICMP报文被封装在IP数据报中发送</strong></li> </ul> <h3 id=1-icmp>1. ICMP差错报文<a class=headerlink href=#1-icmp title="Permanent link">&para;</a></h3> <p><strong>ICMP差错报文共有以下五种：</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253551037-b444f9e8-de4e-4efd-8741-c79e08ff2354.png></p> <p><strong>终点不可达</strong></p> <ul> <li>当路由器或主机不能交付数据报时，就向源点发送终点不可达报文。具体可再根据ICMP的代码字段细分为目的网络不可达、目的主机不可达、目的协议不可达、目的端口不可达、目的网络未知、目的主机未知等13种错误</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253551698-f7a5686c-bb96-4f00-b14c-c3b86424f15c.png></p> <p><strong>源点抑制</strong></p> <ul> <li>当路由器或主机由于拥塞而丢弃数据报时，就向源点发送源点抑制报文，使源点知道应当把数据报的发送速率放慢</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253551970-c12ca551-0c78-4618-8125-1d62165c566b.png></p> <p><strong>时间超过</strong></p> <ul> <li>当路由器收到一个目的IP地址不是自己的IP数据报时，会将其生存时间TTL字段的值减1。若结果不为0，则将该IP数据报转发出去；若结果为0，除丢弃该IP数据报外，还要向源点发送时间超过报文</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253551889-79c71a06-3fa0-4ea8-a826-055534a18e7a.png></p> <ul> <li>另外，当终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，也会向源点发送时间超过报文</li> </ul> <p><strong>参数问题</strong></p> <ul> <li>当路由器或目的主机收到IP数据报后，根据其首部中的检验和字段发现首部在传输过程中出现了误码，就丢弃该数据报，并向源点发送参数问题报文。</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253551974-27d1422b-3372-44c6-9e45-01d4d70adb58.png></p> <p><strong>改变路由（重定向）</strong></p> <ul> <li>路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器（可通过更好的路由）</li> </ul> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253552171-489a16b5-4e6a-44a6-9bb7-51cbdc27b5a9.png></p> <p><strong>需要注意，以下情况不应发送ICMP差错报告报文：</strong></p> <ul> <li>对ICMP差错报告报文不再发送ICMP差错报告报文</li> <li>对第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报告报文</li> <li>对具有多播地址的数据报都不发送ICMP差错报告报文</li> <li>对具有特殊地址（如127.0.0.0或0.0.0.0）的数据报不发送ICMP差错报告报文</li> </ul> <p><strong>相关练习题</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253552285-d50d6024-6088-4f3c-8119-a7452cf5f90e.png></p> <h3 id=2-icmp>2. ICMP询问报文<a class=headerlink href=#2-icmp title="Permanent link">&para;</a></h3> <p><strong>回送请求和回答</strong></p> <ul> <li>ICMP回送请求报文是由主机或路由器向一个特定的目的主机发出的询问</li> <li>收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文</li> <li>这种询问报文用来测试目的站是否可达及了解其有关状态</li> </ul> <p><strong>时间戳请求和回答</strong></p> <ul> <li>ICMP时间戳请求报文是请某个主机回答当前的日期和时间</li> <li>在ICMP时间戳回答报文中有一个32位的字段，其中写入的整数代表从1900年1月1日起到当前时刻一共有多少秒</li> <li>时间戳请求与回答可用于时钟同步和时间测量</li> </ul> <h3 id=3-icmp>3. ICMP应用举例<a class=headerlink href=#3-icmp title="Permanent link">&para;</a></h3> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253552347-827233d8-e84f-4b4b-93e2-effe491b92dc.png></p> <p><strong>分组间探测PING</strong></p> <ul> <li><strong>用来测试主机或路由器间的连通性</strong></li> <li><strong>应用层直接使用网际层的ICMP（没有通过运输层的TCP或UDP）</strong></li> <li><strong>使用ICMP回送请求和回答报文</strong></li> </ul> <p><strong>跟踪路由traceroute</strong></p> <ul> <li><strong>用来测试IP数据报从源主机到目的主机要经过那些路由器</strong></li> <li><strong>Window版本</strong></li> <li>tracert命令</li> <li>应用层直接使用网际层ICMP</li> <li>使用了ICMP回送请求和回答报文以及差错报告报文</li> <li><strong>Unix版本</strong></li> <li>traceroute命令</li> <li>在运输层使用UDP协议</li> <li>仅使用ICMP差错报告报文</li> </ul> <p><strong>tracert命令实现原理——举例说明</strong></p> <p>如下图H1想知道到达H2要经过哪些路由器，就要给H2发送ICMP回送请求报文，该报文封装在IP数据报中，然后采用"疯狂试探"的方法：</p> <ol> <li>首先，IP数据报首部中生存时间字段TTL的值被设置为1。到达R1后，TTL减少为0，丢弃IP数据报并给源主机发送ICMP差错报告。H1就知道了第一个路由器R1。</li> </ol> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253552642-fc8d470f-1541-4f11-bf62-b3aa50b09115.png></p> <ol> <li>H1继续发送TTL值为2的IP数据报，同样，H1就知道了第二个路由器R2。</li> </ol> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253552671-5066c41a-0830-446f-9191-8a221f855441.png></p> <ol> <li>H1继续发送TTL值为3的IP数据报，该数据报到达主机H2，生存时间减少为1。H2解析该数据报，发现其内部封装的是ICMP回送请求报文，于是给H1发送封装有ICMP回送请求回答报文的IP数据报。这样，H1知道了已经跟踪到最后一站，即目的主机。</li> </ol> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253552854-9ab7adbe-af98-469e-af38-7de34f7f4b46.png></p> <h2 id=vpnnat>九、虚拟专用网VPN与网络地址转换NAT<a class=headerlink href=#vpnnat title="Permanent link">&para;</a></h2> <h3 id=1-vpn>1. 虚拟专用网VPN<a class=headerlink href=#1-vpn title="Permanent link">&para;</a></h3> <p><strong>利用公用的因特网作为本机构各专用网之间的通信载体，这样的专用网又称为虚拟专用网（Virtual Private NetWork）。</strong></p> <blockquote> <p>虚拟专用网（VPN）被定义为通过一个公用网络（通常是因特网）建立一个临时的、安全的连接，是一条穿过混乱的公用网络的安全、稳定的隧道。虚拟专用网是对企业内部网的扩展。——<a href="https://baike.baidu.com/item/%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91%28VPN%29/4523481?fr=aladdin">百度百科</a></p> </blockquote> <p><strong>那么，虚拟专用网中各主机分配怎样的IP地址呢？</strong></p> <p><strong>由于IPv4地址的紧缺，一个机构能够申请到的IPv4地址数量往往小于本机构所拥有的主机数量。因此，虚拟专用网中的各主机所分配的地址应该是本机构可自由分配的专用地址，而不是需要申请的、在因特网上使用的公有地址。</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253552830-936ba60a-bdf8-485f-82e2-91528f81481a.png></p> <p><strong>需要注意：私有地址只能用于一个机构的内部通信，而不能用于和因特网上的主机通信。也就是私有地址只能用作本地地址而不能用作全球地址。在因特网中的所有路由器对目的地址是私有地址的IP数据报一律不进行转发。</strong></p> <p><strong>举例说明</strong></p> <p>下图为部门A的主机10.1.0.3要给部门B中的主机10.2.0.3发送数据所经历的过程：</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253552890-62c51263-c103-466e-b125-ed21170dc324.png></p> <ol> <li>先封装成内部IP数据报发送给路由器R1。R1收到后发现目的网络必须通过因特网才能到达，就将该内部IP数据包进行加密，然后重新添加上数据报的首部，封装成在因特网上可以发送的外部数据报</li> <li>路由器R2收到该外部数据报后，去掉其首部，将其数据部分进行解密，恢复其原来的内部数据报。再根据原来的目的地址发送数据。</li> </ol> <p>虽然通过了公用的因特网，但在效果上好像是再本机构的专用网上传送一样。从逻辑上看，R1和R2之间好像是一条直通的点对点链路，因此也被称为<strong>IP隧道技术</strong>。</p> <p><strong>本例属于同一机构不同部门的内部网络所构成的虚拟专用网VPN，又称为内联网VPN。</strong></p> <p><strong>有时一个机构的VPN需要有某些外部机构（通常是合作伙伴）参与进来，这样的VPN就称为外联网VPN。</strong></p> <p><strong>在外地工作的员工需要访问公司内部的专用网络，只要在任何地点接入到因特网，运行驻留在员工PC中的VPN软件，在员工的PC和公司主机之间建立VPN隧道，即可访问专用网络中的资源。这种VPN称为远程接入VPN。</strong></p> <h3 id=2-nat>2. 网络地址转换NAT<a class=headerlink href=#2-nat title="Permanent link">&para;</a></h3> <p>1994年提出了一种网络地址转换NAT的方法再次缓解了IPv4地址空间即将耗尽的问题（2019年11月25日IPv4地址完全耗尽）。</p> <p><strong>NAT能使大量使用内部专用地址的专用网络用户共享少量外部全球地址来访问因特网上的主机和资源。</strong></p> <p><strong>问题：使用私有地址的主机如何才能与因特网上使用全球IP地址的主机进行通信呢？</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253553178-b2723492-144c-4eb2-942a-dacda04c2589.png></p> <p><strong>这需要在专用网络连接到因特网的路由器上安装NAT软件。装有NAT软件的路由器叫做NAT路由器，它至少有一个有效的外部全球IP地址。</strong></p> <p><strong>这样，所有使用私有地址的主机在和外界通信时，都要在NAT路由器上将其私有地址转换成全球IP地址。</strong></p> <p><strong>举例说明</strong></p> <p>下图为专用网中某主机192.168.0.2向因特网中某主机218.75.230.30发送数据的过程：</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253553115-92ba78b8-aadd-4a27-9e88-9f6eb0dba6b5.png></p> <p>因特网上的这台主机给源主机发回数据报：</p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253553354-54c2a1f9-66ca-49a3-a7bf-024dde6df8bf.png></p> <p>该IP数据报到达NAT路由器后，路由器在NAT转换表中进行查找，发现该数据报的目的地址所对应的私有地址为192.168.0.2，于是修改目的地址并发送给相应主机。</p> <p><strong>该转换方法存在一个问题：如果NAT路由器具有N个全球IP地址，那么至多只能有N个内网主机能够同时和因特网上的主机通信。</strong></p> <p><strong>由于绝大多数的网络应用都是使用运输层协议TCP或UDP来传送数据，因此可以利用运输层的端口号和IP地址一起进行转换。</strong></p> <p><strong>这样，用一个全球IP地址就可以使多个拥有本地地址的主机同时和因特网上的主机进行通信。这种将端口号和IP地址一起进行转换的技术叫做网络地址与端口号转换NAPT。</strong></p> <p><strong>NAPT——举例说明</strong></p> <p><img alt src=https://cdn.nlark.com/yuque/0/2025/png/53755062/1743253553488-c1809213-0268-4d97-8c44-5ef02ce9483b.png></p> <p>实际上，现在很多家用路由器都是这种NAPT路由器。由于端口号概念属于运输层，此处不再详细解释。</p> <p><strong>问题：内网主机与外网主机间的通信，是否能由外网主机首先发起？</strong></p> <p><strong>答案是否定的。原因是在NAPT转换表中找不到相应的记录，无法把数据报转发给内网中的主机。因此，使用私有地址的主机不能直接充当因特网服务器。</strong></p> <p><strong>对于一些点对点（P2P）网络应用，需要外网主机主动与内网主机进行通信，在通过NAT时也会遇到问题，需要网络应用自己使用一些特殊的NAT穿越技术来解决问题。</strong></p> <p><strong>另外，由于NAT对外网屏蔽了内网主机的网络地址，能为内网的主机提供一定的安全保护。</strong></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="February 9, 2026 11:12:24 CET"><span class=timeago datetime=2026-02-09T11:12:24+01:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="February 9, 2026 11:12:24 CET">2026-02-09</span> </span> <span class=md-source-file__fact> <span class=md-icon title=创建日期> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="February 9, 2026 11:12:24 CET"><span class=timeago datetime=2026-02-09T11:12:24+01:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="February 9, 2026 11:12:24 CET">2026-02-09</span> </span> <span class=md-source-file__fact> <span class=md-icon title=贡献者> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg> </span> <nav> <a href=mailto:coolzest@qq.com>coolzest</a> </nav> </span> </aside> <!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Determine feedback configuration --> <!-- Determine whether to show feedback --> <!-- Was this page helpful? --> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3l137.4 137.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160zm160 352-160-160c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3l137.4 137.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../%E7%89%A9%E7%90%86%E5%B1%82/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 物理层"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 256 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 物理层 </div> </div> </a> <a href=../../../%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/2024-04-22-CTF/ class="md-footer__link md-footer__link--next" aria-label="下一页: 2024-04-22-CTF"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> 2024-04-22-CTF </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022~2025 Coolzest </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/coolzest target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=agkFBQYQDxkeKhsbRAkFBw" target=_blank rel=noopener title=邮箱 class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "../../../..", "features": ["announce.dismiss", "navigation.prune", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "toc.follow", "navigation.indexes", "content.tabs.link", "content.tooltips", "content.code.copy", "content.code.select", "navigation.instant.prefetch", "navigation.sections"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../../../js/timeago.min.js></script> <script src=../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../assets/javascripts/custom.js></script> <script src=../../../../assets/javascripts/click-copy-math.js></script> <script src=https://cdn.jsdelivr.net/npm/codemirror@5.65.2/lib/codemirror.js></script> <script src=https://cdn.jsdelivr.net/npm/codemirror@5.65.2/mode/python/python.js></script> <script src=https://cdn.jsdelivr.net/npm/codemirror@5.65.2/addon/edit/closetag.js></script> </body> </html>